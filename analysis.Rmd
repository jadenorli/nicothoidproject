---
title: "analysis"
author: "Jaden Orli"
date: "2023-03-15"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(RColorBrewer)
library(caret)
library(ggpubr)
library(MASS)
library(lme4)
library(kableExtra)
library(rcompanion)
library(magrittr)
library(magick)
library(patchwork)
source("my_functions.R")
setup_libs()

display.brewer.all(colorblindFriendly = TRUE)
```


#1. Set up 

### a) Color Palette
```{r}
#choose a color palette
display.brewer.pal(n = 8, name = 'OrRd')
brewer.pal(n = 8, name = "OrRd")

#assign colors to names
adults = "#D7301F"
juveniles = "#FDBB84"
totals  = "#990000"
nico_eggs = "#FCC5C0"
crab_eggs = "#EF6548"
low = "#FC8D59"
high = "#990000"


```


### b) Dataframes

#### i) Read in CSVs
```{r}
#read in the latest of the egg mortality data 
egg_mortality <- read_csv("NicothoidProjectAnalysis/RawData/eggmortalitydata2.csv") %>% 
  clean_names() %>%
  select(!16:18) %>% 
  filter(!is.na(pleopod_number)) %>%
  filter(!eds == "M") %>%
  filter(!experiment_id == "Mortality-034") %>%
  mutate(prop_viable_eggs = number_viable_crab_eggs/total_number_crab_eggs) %>% 
  mutate(prop_nonviable_eggs = total_number_non_viable_crab_eggs/total_number_crab_eggs) %>%
  mutate(total_nicos = (number_adult_nicos + number_juvenile_nicos)) %>%
  mutate(color = case_when(eds %in% c("A", "B", "C") ~ "gold1",
                           eds %in% c("D", "E", "F") ~ "darkgoldenrod1",
                           eds %in% c("G", "H", "I") ~ "coral2",
                           eds %in% c("J", "K", "L", "M") ~ "brown4"))

#read in the egg mortality data that has development days
egg_mortality_day <- read_csv("NicothoidProjectAnalysis/RawData/eggmortality_day2.csv") %>% 
  clean_names() %>%
  select(!17:19) %>% 
  filter(!is.na(pleopod_number)) %>%
  filter(!is.na(day)) %>%
  filter(!eds == "M") %>%
  mutate_at(11, as.numeric) %>%
  mutate(prop_viable_eggs = number_viable_crab_eggs/total_number_crab_eggs) %>% 
  mutate(prop_nonviable_eggs = total_number_non_viable_crab_eggs/total_number_crab_eggs) %>%
  mutate(total_nicos = (number_adult_nicos + number_juvenile_nicos))  %>%
  mutate(color = case_when(eds %in% c("A", "B", "C") ~ "gold1",
                           eds %in% c("D", "E", "F") ~ "darkgoldenrod1",
                           eds %in% c("G", "H", "I") ~ "coral2",
                           eds %in% c("J", "K", "L", "M") ~ "brown4"))

#read in the dissections data
dissections <- read_csv("NicothoidProjectAnalysis/RawData/all_dissections.csv") %>% 
  clean_names() %>%
  filter(!is.na(nico_count)) %>%
  filter(!nico_count == "N/A") %>%
  filter(!number_lamellae == "NA") %>%
  mutate_at(c(6,7), as.numeric) %>%
  mutate(prop_nicos = nico_count/number_lamellae) %>%
  rename(nicothoid_count = nico_count)

#read in the autoinfection data for the first brood
autoinfection <- read_csv("NicothoidProjectAnalysis/RawData/first_broods_only.csv") %>% 
  clean_names() %>%
  select(!11) %>%
  select(!13:18) %>%
  filter(!experiment_id == "Autoinfection-055") %>%
  mutate_at(9, as.numeric) %>%
  filter(!total_number_of_eggs == 0) %>%
  mutate(color = case_when(eds %in% c("A", "B", "C") ~ "gold1",
                           eds %in% c("D", "E", "F") ~ "darkgoldenrod1",
                           eds %in% c("G", "H", "I") ~ "coral2",
                           eds %in% c("J", "K", "L", "M") ~ "brown4"))

#read in the autoinfection data for all of the broods
all_broods <- read_csv("NicothoidProjectAnalysis/RawData/all_broods.csv") %>% 
  clean_names() %>%
  select(!11) %>%
  select(!13:18) %>%
  filter(!experiment_id == "Autoinfection-055") %>%
  mutate_at(9, as.numeric) %>%
  filter(!total_number_of_eggs == 0)

#read in the newly cleaned autoinfection data 
new_autoinfection <- read_csv("NicothoidProjectAnalysis/RawData/autoinfection_new_first.csv") %>% 
  clean_names() %>%
  select(!12) %>%
  select(!14:16) %>%
  rename(eds = egg_development_stage) %>%
  filter(!eds == "M") %>%
  mutate_at(9, as.numeric) %>%
  mutate_at(10, as.numeric) %>%
  filter(!experiment_id == "Autoinfection-005") %>%
  filter(!total_number_of_eggs == 0) %>%
  mutate(color = case_when(eds %in% c("A", "B", "C") ~ "gold1",
                           eds %in% c("D", "E", "F") ~ "darkgoldenrod1",
                           eds %in% c("G", "H", "I") ~ "coral2",
                           eds %in% c("J", "K", "L", "M") ~ "brown4"))

```


#### ii) Old Autoinfection Data and Egg Mortality Data

##### - by day 
```{r}
#make a dataframe with the old autoinfection data combined with the egg mortality day data
adult_counts <- autoinfection %>% 
  select(experiment_id, crab_id, date, egg_development_stage, number_of_adult_copepods, number_of_nemerteans, total_number_of_eggs, number_of_copepod_eggs) %>% 
  rename(eds = egg_development_stage, # to match other dataframes
         number_adult_nicos =  number_of_adult_copepods,
         total_number_crab_eggs = total_number_of_eggs,
         number_nico_eggs = number_of_copepod_eggs) %>% 
  full_join(., egg_mortality_day) %>% 
  select(experiment_id, crab_id, date, eds, number_adult_nicos, number_of_nemerteans, total_number_crab_eggs, number_nico_eggs) %>% 
  rename(adult_nicos = number_adult_nicos,
         nemerteans = number_of_nemerteans, 
         crab_eggs = total_number_crab_eggs,
         nico_eggs = number_nico_eggs)

#create the same dataframe as above but with the autoinfection data from all the broods
adult_counts_all_broods <- all_broods %>% 
  select(experiment_id, crab_id, date, egg_development_stage, number_of_adult_copepods, number_of_nemerteans, total_number_of_eggs, number_of_copepod_eggs) %>% 
  rename(eds = egg_development_stage, # to match other dataframes
         number_adult_nicos =  number_of_adult_copepods,
         total_number_crab_eggs = total_number_of_eggs,
         number_nico_eggs = number_of_copepod_eggs) %>% 
  full_join(., egg_mortality_day) %>% 
  select(experiment_id, crab_id, date, eds, number_adult_nicos, number_of_nemerteans, total_number_crab_eggs, number_nico_eggs) %>% 
  rename(adult_nicos = number_adult_nicos,
         nemerteans = number_of_nemerteans, 
         crab_eggs = total_number_crab_eggs,
         nico_eggs = number_nico_eggs)

# want to make a summary table now with extrapolated count assuming 1 million eggs, total count of nicos, total number of crab eggs searched, number of observations on that crab, all per crab    
adult_counts_summary <- adult_counts%>% 
  group_by(crab_id) %>% 
  summarise(total_nicos = sum(adult_nicos),
            mean_nicos_per_count = mean(adult_nicos),
            observations = n(), 
            eggs_searched = sum(crab_eggs)) %>% 
  mutate(nicos_per_egg = total_nicos/eggs_searched) %>% 
  mutate(nicos_extrapolated_1mil = nicos_per_egg*1000000)

##autoinfection data from first broods and egg mortality
#create a dataframe with the proportion of adult nicos per 1000 eggs for all samples
adult_all <- adult_counts %>%
  mutate(prop_adults = (adult_nicos/crab_eggs)*1000)



       

```

##### - by eds 
```{r}
#create a dataframe with the average adult counts per 1000 host eggs per eds 
adult_all_avg <-  adult_all %>%
  group_by(eds) %>%
  summarize(avg_prop_adults = mean(prop_adults)) %>%
  as_tibble()

##autoinfection data from all broods and egg mortality
#create a dataframe with the proportion of adult nicos per 1000 host eggs for all samples
adult_all_broods <- adult_counts_all_broods %>%
  mutate(prop_adults = (adult_nicos/crab_eggs)*1000)

#create a dataframe with the average number of adults per 1000 host eggs
adult_all_broods_avg <- adult_all_broods %>%
  group_by(eds) %>%
  summarize(avg_prop_adults = mean(prop_adults)) %>%
  as_tibble()

##autoinfection data from first broods and egg mortality
#create a dataframe with the proportion of nico eggs per 1000 host eggs for all samples
nico_egg_all <- adult_counts %>%
  mutate(prop_nico_eggs = (nico_eggs/crab_eggs)*1000)

#create a dataframe with the average nico eggs per 1000 host eggs for all samples
nico_egg_all_avg <-  nico_egg_all %>%
  group_by(eds) %>%
  summarize(avg_prop_nico_eggs = mean(prop_nico_eggs)) %>%
  as_tibble()

##autoinfection data from all broods and egg mortality
#create a dataframe with the proportion of nico eggs per 1000 host eggs for all samples
nico_egg_all_broods <- adult_counts_all_broods %>%
  mutate(prop_nico_eggs = (nico_eggs/crab_eggs)*1000)

#create a dataframe with the average nico eggs per 1000 host eggs for all samples
nico_egg_all_broods_avg <- nico_egg_all_broods %>%
  group_by(eds) %>%
  summarize(avg_prop_nico_eggs = mean(prop_nico_eggs)) %>%
  as_tibble()




```


#### iii) New Autoinfection Data 

##### - by day 
```{r}
#make a dataframe with the new autoinfection data combined with the egg mortality day data
adult_counts_new <- new_autoinfection %>% 
  select(experiment_id, crab_id, day, eds, number_of_adult_copepods, number_of_nemerteans, total_number_of_eggs, number_of_copepod_eggs) %>% 
  rename(number_adult_nicos =  number_of_adult_copepods,
         total_number_crab_eggs = total_number_of_eggs,
         number_nico_eggs = number_of_copepod_eggs) %>% 
  full_join(., egg_mortality_day) %>% 
  select(experiment_id, crab_id, day, eds, number_adult_nicos, number_of_nemerteans, total_number_crab_eggs, number_nico_eggs) %>% 
  rename(adult_nicos = number_adult_nicos,
         nemerteans = number_of_nemerteans, 
         crab_eggs = total_number_crab_eggs,
         nico_eggs = number_nico_eggs)

# want to make a summary table now with extrapolated count assuming 1 million eggs, total count of nicos, total number of crab eggs searched, number of observations on that crab, all per crab    
adult_summary_new <- adult_counts_new %>% 
  group_by(crab_id) %>% 
  summarise(total_nicos = sum(adult_nicos),
            mean_nicos_per_count = mean(adult_nicos),
            observations = n(), 
            eggs_searched = sum(crab_eggs)) %>% 
  mutate(nicos_per_egg = total_nicos/eggs_searched) %>% 
  mutate(nicos_extrapolated_1mil = nicos_per_egg*1000000)

#create a dataframe with the average number, max number, and min number of adults per day per one million host eggs
adult_all_avg_new_day <- adult_all_new %>%
  group_by(day) %>%
  summarize(avg_prop_adults = mean(prop_adults),
            max_prop_adults = max(prop_adults),
            min_prop_adults = min(prop_adults)) %>%
  mutate(scaled_adults = avg_prop_adults*1000000) %>%
  mutate(max_scaled_adults = max_prop_adults*1000000) %>%
  mutate(min_scaled_adults = min_prop_adults*1000000) %>%
  as_tibble()

#create a dataframe with the average nico eggs per day per one million host eggs
nico_egg_all_avg_new_day <-  nico_egg_all_new %>%
  group_by(day) %>%
  summarize(avg_prop_nico_eggs = mean(prop_nico_eggs),
            max_prop_nico_eggs = max(prop_nico_eggs),
            min_prop_nico_eggs = min(prop_nico_eggs)) %>%
  mutate(scaled_nico_eggs = avg_prop_nico_eggs*1000000) %>%
  mutate(max_scaled_nico_eggs = max_prop_nico_eggs*1000000) %>%
  mutate(min_scaled_nico_eggs = min_prop_nico_eggs*1000000) %>%
  as_tibble()


       

```


##### - by eds
```{r}
##new autoinfection data from first broods and egg mortality
#create a dataframe with the proportion of adult nicos per 1000 host eggs for all samples
adult_all_new <- adult_counts_new %>%
  mutate(prop_adults = (adult_nicos/crab_eggs)*1000) %>%
  mutate(prop_adults_alone = adult_nicos/crab_eggs) %>%
  mutate(scaled_adults = prop_adults_alone*1000000) %>%
  as_tibble()

#create a dataframe with the average number of adults per 1000 host eggs
adult_all_avg_new <-  adult_all_new %>%
  group_by(eds) %>%
  summarize(avg_scaled_adults = mean(scaled_adults),
            max_scaled_adults = max(scaled_adults),
            min_scaled_adults = min(scaled_adults),
            avg_prop_adults = mean(prop_adults)) %>%
  as_tibble()

##autoinfection data from first broods and egg mortality
#create a dataframe with the proportion of nico eggs per 1000 host eggs for all samples
nico_egg_all_new <- adult_counts_new %>%
  mutate(prop_nico_eggs = (nico_eggs/crab_eggs)*1000) %>%
  mutate(prop_nico_eggs_alone = nico_eggs/crab_eggs) %>%
  mutate(scaled_nico_eggs = prop_nico_eggs_alone*1000000) %>%
  as_tibble()

#create a dataframe with the average nico eggs per 1000 host eggs for all samples
nico_egg_all_avg_new <- nico_egg_all_new %>%
  group_by(eds) %>%
  summarize(avg_scaled_nico_eggs = mean(scaled_nico_eggs),
            max_scaled_nico_eggs = max(scaled_nico_eggs),
            min_scaled_nico_eggs = min(scaled_nico_eggs),
            avg_prop_nico_eggs = mean(prop_nico_eggs)) %>%
  as_tibble()



```


#### iv) Random Dataframes


##### - egg mortality eds dataframe 
```{r}
#create a data frame with the average values of viable and nonviable crab eggs across each EDS for all crabs 
eggs_mort_eds_avg <- egg_mortality %>%
  group_by(eds) %>%
  summarize(avg_prop_viable_eggs = mean(prop_viable_eggs),
            avg_prop_nonviable_eggs = mean(prop_nonviable_eggs)) %>%
  as_tibble()

#create a dataframe with the low infestation crabs (all except 034, 037, 045, 051, 052, 053, and 060)
low_crab_eds <- egg_mortality %>%
  filter(!crab_id == "ANT-GAV-034") %>%
  filter(!crab_id == "ANT-GAV-037") %>%
  filter(!crab_id == "ANT-GAV-045") %>%
  filter(!crab_id == "ANT-GAV-051") %>%
  filter(!crab_id == "ANT-GAV-052") %>%
  filter(!crab_id == "ANT-GAV-053") %>%
  filter(!crab_id == "ANT-GAV-060")

#create a data frame with the average values of viable and nonviable crab eggs across each EDS for low infestation crabs 
eggs_mort_avg_low_avg_eds <- low_crab_eds %>%
  group_by(eds) %>%
  summarize(avg_prop_viable_eggs = mean(prop_viable_eggs),
            avg_prop_nonviable_eggs = mean(prop_nonviable_eggs)) %>%
  as_tibble()

#create a dataframe with the high infestation crabs (034, 037, 045, 051, 052, 053, and 060)
high_crab_eds <- egg_mortality %>%
  filter(crab_id %in% c("ANT-GAV-034", "ANT-GAV-037", "ANT-GAV-045", "ANT-GAV-051", "ANT-GAV-052", "ANT-GAV-053", "ANT-GAV-060"))

#create a data frame with the average values of viable and nonviable crab eggs across each EDS for high infestation crabs  
eggs_mort_avg_high_avg_eds <- high_crab_eds %>%
  group_by(eds) %>%
  summarize(avg_prop_viable_eggs = mean(prop_viable_eggs),
            avg_prop_nonviable_eggs = mean(prop_nonviable_eggs)) %>%
  as_tibble()

#create a data frame with the average values across each development days for all crabs 
eggs_mort_day_avg <- egg_mortality_day %>%
  group_by(day) %>%
  summarize(avg_prop_viable_eggs = mean(prop_viable_eggs),
            avg_prop_nonviable_eggs = mean(prop_nonviable_eggs),
            avg_adult_nicos = mean(number_adult_nicos),
            avg_juvenile_nicos = mean(number_juvenile_nicos),
            avg_nico_eggs = mean(number_nico_eggs),
            crab_id = crab_id) %>%
  as_tibble()

##pivot the data longer 
eggs_mort_day_long <- eggs_mort_day_avg %>%
  pivot_longer(names_to = "averages",
               cols = c("avg_prop_viable_eggs", "avg_prop_nonviable_eggs"))

#average the various life stages for all crabs
timeseries_avg_eds <- timeseries %>%
  mutate(prop_adults_alone = number_adult_nicos/total_number_crab_eggs) %>%
  mutate(prop_juveniles_alone = number_juvenile_nicos/total_number_crab_eggs) %>%
  mutate(prop_total_nicos_alone = total_nicos/total_number_crab_eggs) %>%
  mutate(prop_nico_eggs_alone = number_nico_eggs/total_number_crab_eggs) %>%
  group_by(eds) %>%
  summarize(avg_prop_adults = mean(prop_adults_alone),
            max_prop_adults = max(prop_adults_alone),
            min_prop_adults = min(prop_adults_alone),
            avg_prop_juveniles = mean(prop_juveniles_alone),
            max_prop_juveniles = max(prop_juveniles_alone),
            min_prop_juveniles = min(prop_juveniles_alone),
            avg_prop_total_nicos = mean(prop_total_nicos_alone),
            max_prop_total_nicos = max(prop_total_nicos_alone),
            min_prop_total_nicos = min(prop_total_nicos_alone),
            avg_prop_nico_eggs = mean(prop_nico_eggs_alone),
            max_prop_nico_eggs = max(prop_nico_eggs_alone),
            min_prop_nico_eggs = min(prop_nico_eggs_alone)) %>%
  mutate(scaled_adults = avg_prop_adults*1000000) %>%
  mutate(max_scaled_adults = max_prop_adults*1000000) %>%
  mutate(min_scaled_adults = min_prop_adults*1000000) %>%
  mutate(scaled_juveniles = avg_prop_juveniles*1000000) %>%
  mutate(max_scaled_juveniles = max_prop_juveniles*1000000) %>%
  mutate(min_scaled_juveniles = min_prop_juveniles*1000000) %>%  
  mutate(scaled_total_nicos = avg_prop_total_nicos*1000000) %>%
  mutate(max_scaled_total_nicos = max_prop_total_nicos*1000000) %>%
  mutate(min_scaled_total_nicos = min_prop_total_nicos*1000000) %>%
  mutate(scaled_nico_eggs = avg_prop_nico_eggs*1000000) %>%
  mutate(max_scaled_nico_eggs = max_prop_nico_eggs*1000000) %>%
  mutate(min_scaled_nico_eggs = min_prop_nico_eggs*1000000) %>%
  as_tibble()

#select the high infested crabs only and average the life stages per eds 
high_timeseries_avg_eds <- high_timeseries %>%
  group_by(eds) %>%
  summarize(avg_prop_adults = mean(prop_adults_alone),
            max_prop_adults = max(prop_adults_alone),
            min_prop_adults = min(prop_adults_alone),
            avg_prop_juveniles = mean(prop_juveniles_alone),
            max_prop_juveniles = max(prop_juveniles_alone),
            min_prop_juveniles = min(prop_juveniles_alone),
            avg_prop_total_nicos = mean(prop_total_nicos_alone),
            max_prop_total_nicos = max(prop_total_nicos_alone),
            min_prop_total_nicos = min(prop_total_nicos_alone),
            avg_prop_nico_eggs = mean(prop_nico_eggs_alone),
            max_prop_nico_eggs = max(prop_nico_eggs_alone),
            min_prop_nico_eggs = min(prop_nico_eggs_alone)) %>%
  mutate(scaled_adults = avg_prop_adults*1000000) %>%
  mutate(max_scaled_adults = max_prop_adults*1000000) %>%
  mutate(min_scaled_adults = min_prop_adults*1000000) %>%
  mutate(scaled_juveniles = avg_prop_juveniles*1000000) %>%
  mutate(max_scaled_juveniles = max_prop_juveniles*1000000) %>%
  mutate(min_scaled_juveniles = min_prop_juveniles*1000000) %>%  
  mutate(scaled_total_nicos = avg_prop_total_nicos*1000000) %>%
  mutate(max_scaled_total_nicos = max_prop_total_nicos*1000000) %>%
  mutate(min_scaled_total_nicos = min_prop_total_nicos*1000000) %>%
  mutate(scaled_nico_eggs = avg_prop_nico_eggs*1000000) %>%
  mutate(max_scaled_nico_eggs = max_prop_nico_eggs*1000000) %>%
  mutate(min_scaled_nico_eggs = min_prop_nico_eggs*1000000) %>%
  as_tibble()

#select the high infested crabs only and average the life stages per eds 
low_timeseries_avg_eds <- low_timeseries %>%
  group_by(eds) %>%
  summarize(avg_prop_adults = mean(prop_adults_alone),
            max_prop_adults = max(prop_adults_alone),
            min_prop_adults = min(prop_adults_alone),
            avg_prop_juveniles = mean(prop_juveniles_alone),
            max_prop_juveniles = max(prop_juveniles_alone),
            min_prop_juveniles = min(prop_juveniles_alone),
            avg_prop_total_nicos = mean(prop_total_nicos_alone),
            max_prop_total_nicos = max(prop_total_nicos_alone),
            min_prop_total_nicos = min(prop_total_nicos_alone),
            avg_prop_nico_eggs = mean(prop_nico_eggs_alone),
            max_prop_nico_eggs = max(prop_nico_eggs_alone),
            min_prop_nico_eggs = min(prop_nico_eggs_alone)) %>%
  mutate(scaled_adults = avg_prop_adults*1000000) %>%
  mutate(max_scaled_adults = max_prop_adults*1000000) %>%
  mutate(min_scaled_adults = min_prop_adults*1000000) %>%
  mutate(scaled_juveniles = avg_prop_juveniles*1000000) %>%
  mutate(max_scaled_juveniles = max_prop_juveniles*1000000) %>%
  mutate(min_scaled_juveniles = min_prop_juveniles*1000000) %>%  
  mutate(scaled_total_nicos = avg_prop_total_nicos*1000000) %>%
  mutate(max_scaled_total_nicos = max_prop_total_nicos*1000000) %>%
  mutate(min_scaled_total_nicos = min_prop_total_nicos*1000000) %>%
  mutate(scaled_nico_eggs = avg_prop_nico_eggs*1000000) %>%
  mutate(max_scaled_nico_eggs = max_prop_nico_eggs*1000000) %>%
  mutate(min_scaled_nico_eggs = min_prop_nico_eggs*1000000) %>%
  as_tibble()



```




##### - egg mortality day dataframe
```{r}
#create a dataframe with the low infestation crabs (all except 034, 037, 045, 051, 052, 053, and 060)
low_infested <- egg_mortality_day %>%
  filter(!crab_id == "ANT-GAV-034") %>%
  filter(!crab_id == "ANT-GAV-037") %>%
  filter(!crab_id == "ANT-GAV-045") %>%
  filter(!crab_id == "ANT-GAV-051") %>%
  filter(!crab_id == "ANT-GAV-052") %>%
  filter(!crab_id == "ANT-GAV-053") %>%
  filter(!crab_id == "ANT-GAV-060") 
  
#create a data frame with the average values of viable and nonviable crab eggs across each EDS for low infestation crabs  
eggs_mort_day_avg_low <- low_infested %>%
  group_by(day) %>%
  summarize(avg_prop_viable_eggs = mean(prop_viable_eggs),
            avg_prop_nonviable_eggs = mean(prop_nonviable_eggs)) %>%
  as_tibble()

#create a dataframe with the high infestation crabs (034, 037, 045, 051, 052, 053, and 060)
high_infested <- egg_mortality_day %>%
  filter(crab_id %in% c("ANT-GAV-034", "ANT-GAV-037", "ANT-GAV-045", "ANT-GAV-051", "ANT-GAV-052", "ANT-GAV-053", "ANT-GAV-060"))

#create a data frame with the average values of viable and nonviable crab eggs across each EDS for low infestation crabs  
eggs_mort_day_avg_high <- high_infested %>%
  group_by(day) %>%
  summarize(avg_prop_viable_eggs = mean(prop_viable_eggs),
            avg_prop_nonviable_eggs = mean(prop_nonviable_eggs)) %>%
  as_tibble()

#create a dataframe which has the proportion of the life stage per the number of crab eggs in the sample then times 1000 (scaled)
timeseries <- egg_mortality_day %>%
  mutate(prop_adults = (number_adult_nicos/total_number_crab_eggs)*1000) %>%
  mutate(prop_juveniles = (number_juvenile_nicos/total_number_crab_eggs)*1000) %>%
  mutate(prop_nico_eggs = (number_nico_eggs/total_number_crab_eggs)*1000) %>%
  mutate(prop_total_nicos = (total_nicos/total_number_crab_eggs)*1000) %>%
  mutate(prop_adults_alone = number_adult_nicos/total_number_crab_eggs) %>%
  mutate(prop_juveniles_alone = number_juvenile_nicos/total_number_crab_eggs) %>%
  mutate(prop_total_nicos_alone = total_nicos/total_number_crab_eggs) %>%
  mutate(prop_nico_eggs_alone = number_nico_eggs/total_number_crab_eggs) %>%
  mutate(scaled_adults = prop_adults_alone*1000000) %>%
  mutate(scaled_juveniles = prop_juveniles_alone*1000000) %>%
  mutate(scaled_total_nicos = prop_total_nicos_alone*1000000) %>%
  mutate(scaled_nico_eggs = prop_nico_eggs_alone*1000000) %>%
  mutate(scaled_viable_eggs = prop_viable_eggs*1000000) %>%
  mutate(scaled_nonviable_eggs = prop_nonviable_eggs*1000000) %>%
  as_tibble()

##create a dataframe with the averages from the above dataframe 
timeseries_avg <- timeseries %>%
  mutate(prop_adults_alone = number_adult_nicos/total_number_crab_eggs) %>%
  mutate(prop_juveniles_alone = number_juvenile_nicos/total_number_crab_eggs) %>%
  mutate(prop_total_nicos_alone = total_nicos/total_number_crab_eggs) %>%
  mutate(prop_nico_eggs_alone = number_nico_eggs/total_number_crab_eggs) %>%
  group_by(day) %>%
  summarize(avg_prop_adults = mean(prop_adults_alone),
            max_prop_adults = max(prop_adults_alone),
            min_prop_adults = min(prop_adults_alone),
            avg_prop_juveniles = mean(prop_juveniles_alone),
            max_prop_juveniles = max(prop_juveniles_alone),
            min_prop_juveniles = min(prop_juveniles_alone),
            avg_prop_total_nicos = mean(prop_total_nicos_alone),
            max_prop_total_nicos = max(prop_total_nicos_alone),
            min_prop_total_nicos = min(prop_total_nicos_alone),
            avg_prop_nico_eggs = mean(prop_nico_eggs_alone),
            max_prop_nico_eggs = max(prop_nico_eggs_alone),
            min_prop_nico_eggs = min(prop_nico_eggs_alone),
            avg_prop_viable_eggs = mean(prop_viable_eggs),
            max_prop_viable_eggs = max(prop_viable_eggs),
            min_prop_viable_eggs = min(prop_viable_eggs),
            avg_prop_nonviable_eggs = mean(prop_nonviable_eggs),
            max_prop_nonviable_eggs = max(prop_nonviable_eggs),
            min_prop_nonviable_eggs = min(prop_nonviable_eggs)) %>%
  mutate(scaled_adults = avg_prop_adults*1000000) %>%
  mutate(max_scaled_adults = max_prop_adults*1000000) %>%
  mutate(min_scaled_adults = min_prop_adults*1000000) %>%
  mutate(scaled_juveniles = avg_prop_juveniles*1000000) %>%
  mutate(max_scaled_juveniles = max_prop_juveniles*1000000) %>%
  mutate(min_scaled_juveniles = min_prop_juveniles*1000000) %>%  
  mutate(scaled_total_nicos = avg_prop_total_nicos*1000000) %>%
  mutate(max_scaled_total_nicos = max_prop_total_nicos*1000000) %>%
  mutate(min_scaled_total_nicos = min_prop_total_nicos*1000000) %>%
  mutate(scaled_nico_eggs = avg_prop_nico_eggs*1000000) %>%
  mutate(max_scaled_nico_eggs = max_prop_nico_eggs*1000000) %>%
  mutate(min_scaled_nico_eggs = min_prop_nico_eggs*1000000) %>% 
  mutate(scaled_prop_viable_eggs = avg_prop_viable_eggs*1000000) %>%
  mutate(max_scaled_prop_viable_eggs = max_prop_viable_eggs*1000000) %>%
  mutate(min_scaled_prop_viable_eggs = min_prop_viable_eggs*1000000) %>% 
  mutate(scaled_prop_nonviable_eggs = avg_prop_nonviable_eggs*1000000) %>%
  mutate(max_scaled_prop_nonviable_eggs = max_prop_nonviable_eggs*1000000) %>%
  mutate(min_scaled_prop_nonviable_eggs = min_prop_nonviable_eggs*1000000) %>%
  as_tibble()
  
#select the highly infested crabs only from the timeseries dataframe 
high_timeseries <- timeseries %>%
  filter(crab_id %in% c("ANT-GAV-034", "ANT-GAV-037", "ANT-GAV-045", "ANT-GAV-051", "ANT-GAV-052", "ANT-GAV-053", "ANT-GAV-060"))

#high infestation crabs with average amount of each life stage per 1000 host eggs per development day 
high_timeseries_avg <- high_timeseries %>%
  group_by(day) %>%
  summarize(avg_prop_adults = mean(prop_adults_alone),
            max_prop_adults = max(prop_adults_alone),
            min_prop_adults = min(prop_adults_alone),
            avg_prop_juveniles = mean(prop_juveniles_alone),
            max_prop_juveniles = max(prop_juveniles_alone),
            min_prop_juveniles = min(prop_juveniles_alone),
            avg_prop_total_nicos = mean(prop_total_nicos_alone),
            max_prop_total_nicos = max(prop_total_nicos_alone),
            min_prop_total_nicos = min(prop_total_nicos_alone),
            avg_prop_nico_eggs = mean(prop_nico_eggs_alone),
            max_prop_nico_eggs = max(prop_nico_eggs_alone),
            min_prop_nico_eggs = min(prop_nico_eggs_alone),
            avg_prop_viable_eggs = mean(prop_viable_eggs),
            max_prop_viable_eggs = max(prop_viable_eggs),
            min_prop_viable_eggs = min(prop_viable_eggs),
            avg_prop_nonviable_eggs = mean(prop_nonviable_eggs),
            max_prop_nonviable_eggs = max(prop_nonviable_eggs),
            min_prop_nonviable_eggs = min(prop_nonviable_eggs)) %>%
  mutate(scaled_adults = avg_prop_adults*1000000) %>%
  mutate(max_scaled_adults = max_prop_adults*1000000) %>%
  mutate(min_scaled_adults = min_prop_adults*1000000) %>%
  mutate(scaled_juveniles = avg_prop_juveniles*1000000) %>%
  mutate(max_scaled_juveniles = max_prop_juveniles*1000000) %>%
  mutate(min_scaled_juveniles = min_prop_juveniles*1000000) %>%  
  mutate(scaled_total_nicos = avg_prop_total_nicos*1000000) %>%
  mutate(max_scaled_total_nicos = max_prop_total_nicos*1000000) %>%
  mutate(min_scaled_total_nicos = min_prop_total_nicos*1000000) %>%
  mutate(scaled_nico_eggs = avg_prop_nico_eggs*1000000) %>%
  mutate(max_scaled_nico_eggs = max_prop_nico_eggs*1000000) %>%
  mutate(min_scaled_nico_eggs = min_prop_nico_eggs*1000000)  %>% 
  mutate(scaled_prop_viable_eggs = avg_prop_viable_eggs*1000000) %>%
  mutate(max_scaled_prop_viable_eggs = max_prop_viable_eggs*1000000) %>%
  mutate(min_scaled_prop_viable_eggs = min_prop_viable_eggs*1000000) %>%
  mutate(scaled_prop_nonviable_eggs = avg_prop_nonviable_eggs*1000000) %>%
  mutate(max_scaled_prop_nonviable_eggs = max_prop_nonviable_eggs*1000000) %>%
  mutate(min_scaled_prop_nonviable_eggs = min_prop_nonviable_eggs*1000000) %>%
  as_tibble()

#select the loww infested crabs only from the timeseries dataframe 
low_timeseries <- timeseries %>%
  filter(!crab_id == "ANT-GAV-034") %>%
  filter(!crab_id == "ANT-GAV-037") %>%
  filter(!crab_id == "ANT-GAV-045") %>%
  filter(!crab_id == "ANT-GAV-051") %>%
  filter(!crab_id == "ANT-GAV-052") %>%
  filter(!crab_id == "ANT-GAV-053") %>%
  filter(!crab_id == "ANT-GAV-060") 


#low infestation crabs with average amount of each life stage per 1000 host eggs per development day 
low_timeseries_avg <- low_timeseries %>%
  group_by(day) %>%
  summarize(avg_prop_adults = mean(prop_adults_alone),
            max_prop_adults = max(prop_adults_alone),
            min_prop_adults = min(prop_adults_alone),
            avg_prop_juveniles = mean(prop_juveniles_alone),
            max_prop_juveniles = max(prop_juveniles_alone),
            min_prop_juveniles = min(prop_juveniles_alone),
            avg_prop_total_nicos = mean(prop_total_nicos_alone),
            max_prop_total_nicos = max(prop_total_nicos_alone),
            min_prop_total_nicos = min(prop_total_nicos_alone),
            avg_prop_nico_eggs = mean(prop_nico_eggs_alone),
            max_prop_nico_eggs = max(prop_nico_eggs_alone),
            min_prop_nico_eggs = min(prop_nico_eggs_alone),
            avg_prop_viable_eggs = mean(prop_viable_eggs),
            max_prop_viable_eggs = max(prop_viable_eggs),
            min_prop_viable_eggs = min(prop_viable_eggs),
            avg_prop_nonviable_eggs = mean(prop_nonviable_eggs),
            max_prop_nonviable_eggs = max(prop_nonviable_eggs),
            min_prop_nonviable_eggs = min(prop_nonviable_eggs)) %>%
  mutate(scaled_adults = avg_prop_adults*1000000) %>%
  mutate(max_scaled_adults = max_prop_adults*1000000) %>%
  mutate(min_scaled_adults = min_prop_adults*1000000) %>%
  mutate(scaled_juveniles = avg_prop_juveniles*1000000) %>%
  mutate(max_scaled_juveniles = max_prop_juveniles*1000000) %>%
  mutate(min_scaled_juveniles = min_prop_juveniles*1000000) %>%  
  mutate(scaled_total_nicos = avg_prop_total_nicos*1000000) %>%
  mutate(max_scaled_total_nicos = max_prop_total_nicos*1000000) %>%
  mutate(min_scaled_total_nicos = min_prop_total_nicos*1000000) %>%
  mutate(scaled_nico_eggs = avg_prop_nico_eggs*1000000) %>%
  mutate(max_scaled_nico_eggs = max_prop_nico_eggs*1000000) %>%
  mutate(min_scaled_nico_eggs = min_prop_nico_eggs*1000000) %>% 
  mutate(scaled_prop_viable_eggs = avg_prop_viable_eggs*1000000) %>%
  mutate(max_scaled_prop_viable_eggs = max_prop_viable_eggs*1000000) %>%
  mutate(min_scaled_prop_viable_eggs = min_prop_viable_eggs*1000000) %>%
  mutate(scaled_prop_nonviable_eggs = avg_prop_nonviable_eggs*1000000) %>%
  mutate(max_scaled_prop_nonviable_eggs = max_prop_nonviable_eggs*1000000) %>%
  mutate(min_scaled_prop_nonviable_eggs = min_prop_nonviable_eggs*1000000) %>%
  as_tibble()

#group the data by crab ID for the egg mortality day dataframe 
crab_id <- egg_mortality_day %>%
  mutate(prop_adult_nicos = number_adult_nicos/total_number_crab_eggs) %>%
  mutate(prop_juvenile_nicos = number_juvenile_nicos/total_number_crab_eggs) %>%
  mutate(prop_total_nicos = total_nicos/total_number_crab_eggs) %>%
  mutate(prop_nico_eggs = number_nico_eggs/total_number_crab_eggs) %>%
  mutate(scaled_prop_adult_nicos = prop_adult_nicos*1000000) %>%
  mutate(scaled_prop_juvenile_nicos = prop_juvenile_nicos*1000000) %>%
  mutate(scaled_prop_total_nicos = prop_total_nicos*1000000) %>%
  mutate(scaled_prop_nico_eggs = prop_nico_eggs*1000000) %>%
  group_by(crab_id) %>%
    summarise(adults = sum(number_adult_nicos),
              juveniles = sum(number_juvenile_nicos),
              total_nicos = sum(total_nicos),
              nico_nicos = sum(number_nico_eggs),
              avg_adult_nicos = mean(prop_adult_nicos),
              avg_juvenile_nicos = mean(prop_juvenile_nicos),
              avg_total_nicos = mean(prop_total_nicos),
              avg_nico_eggs = mean(prop_nico_eggs),
              adults_scaled = sum(scaled_prop_adult_nicos),
              juveniles_scaled = sum(scaled_prop_juvenile_nicos),
              total_nicos_scaled = sum(scaled_prop_total_nicos),
              nico_eggs_scaled = sum(scaled_prop_nico_eggs),) %>%
  as_tibble()


#make a dataframe with the extrapolated counts from the totals per crab ID 
totals_per_crab_id <- egg_mortality_day %>% 
  group_by(crab_id) %>% 
  summarise(adults = sum(number_adult_nicos),
            juveniles = sum(number_juvenile_nicos),
            total_nicos = sum(total_nicos),
            nico_eggs = sum(number_nico_eggs),
            total_crab_eggs = sum(total_number_crab_eggs)) %>%
  mutate(adults_per_egg = adults/total_crab_eggs) %>%
  mutate(juveniles_per_egg = juveniles/total_crab_eggs) %>%
  mutate(total_nicos_per_egg = total_nicos/total_crab_eggs) %>%
  mutate(nico_eggs_per_egg = nico_eggs/total_crab_eggs) %>%
  mutate(adults_scaled = adults_per_egg*1000000) %>%
  mutate(juveniles_scaled = juveniles_per_egg*1000000) %>%
  mutate(total_nicos_scaled = total_nicos_per_egg*1000000) %>%
  mutate(nico_eggs_scaled = nico_eggs_per_egg*1000000) %>%
  as_tibble()

#scale up the number of each life stage per each day from the egg mortality data 
scaled_data_egg_mort <- egg_mortality_day %>%
  mutate(prop_adults = number_adult_nicos/total_number_crab_eggs) %>%
  mutate(prop_juveniles = number_juvenile_nicos/total_number_crab_eggs) %>%
  mutate(prop_total_nicos = total_nicos/total_number_crab_eggs) %>%
  mutate(prop_nico_eggs = number_nico_eggs/total_number_crab_eggs) %>%
  group_by(day) %>%
  summarize(avg_prop_adults = mean(prop_adults), 
              avg_prop_juveniles = mean(prop_juveniles),
              avg_prop_total_nicos = mean(prop_total_nicos), 
              avg_prop_nico_eggs = mean(prop_nico_eggs)) %>%
  mutate(scaled_adults = avg_prop_adults*1000000) %>%
  mutate(scaled_juveniles = avg_prop_juveniles*1000000) %>%
  mutate(scaled_total_nicos = avg_prop_total_nicos*1000000) %>%
  mutate(scaled_nico_eggs = avg_prop_nico_eggs*1000000) %>%
  as_tibble()



```



#### v) Transformation Dataframes
```{r}
#scale up the data then log transform for egg mortality data 
egg_mortality_log <- egg_mortality %>%
  mutate(scale_prop_viable_eggs = prop_viable_eggs*1000) %>%
  mutate(log_prop_viable_eggs = log(scale_prop_viable_eggs)) %>%
  mutate(log_adult_nicos = log(number_adult_nicos + 1)) %>%
  mutate(log_juvenile_nicos = log(number_juvenile_nicos + 1)) %>%
  mutate(log_total_nicos = log(total_nicos + 1)) %>%
  mutate(log_nico_eggs = log(number_nico_eggs + 1)) 

#filter for the low infestation crabs from log transform data 
egg_mortality_log_low <- egg_mortality_log%>%
  filter(!crab_id == "ANT-GAV-034") %>%
  filter(!crab_id == "ANT-GAV-037") %>%
  filter(!crab_id == "ANT-GAV-045") %>%
  filter(!crab_id == "ANT-GAV-053") 

#filter for the high infestation crabs from log transform data 
egg_mortality_log_high <- egg_mortality_log %>%
  filter(crab_id %in% c("ANT-GAV-034", "ANT-GAV-037", "ANT-GAV-045", "ANT-GAV-053"))

#scale up the data then sqrt transform for egg mortality data
egg_mortality_sqrt <- egg_mortality %>%
  mutate(scale_prop_viable_eggs = prop_viable_eggs*1000) %>%
  mutate(sqrt_prop_viable_eggs = sqrt(scale_prop_viable_eggs)) %>%
  mutate(sqrt_adult_nicos = sqrt(number_adult_nicos + 1)) %>%
  mutate(sqrt_juvenile_nicos = sqrt(number_juvenile_nicos + 1)) %>%
  mutate(sqrt_total_nicos = sqrt(total_nicos + 1)) %>%
  mutate(sqrt_nico_eggs = sqrt(number_nico_eggs + 1)) 

#filter for the low infestation crabs from sqrt transform data
egg_mortality_sqrt_low <- egg_mortality_sqrt %>%
  filter(!crab_id == "ANT-GAV-034") %>%
  filter(!crab_id == "ANT-GAV-037") %>%
  filter(!crab_id == "ANT-GAV-045") %>%
  filter(!crab_id == "ANT-GAV-053") 

#filter for the high infestation crabs from sqrt transform data 
egg_mortality_sqrt_high <- egg_mortality_sqrt %>%
  filter(crab_id %in% c("ANT-GAV-034", "ANT-GAV-037", "ANT-GAV-045", "ANT-GAV-053"))





```


# 2. Egg Mortality Timeseries

### a) Egg Mortality Data by EDS 

#### i) All Crabs

##### - prop viable eggs
```{r}
#plot the data for the longer data frame with the averages as groups
eggs_mort_eds_vis <- ggplot(data = egg_mortality, 
       aes(x = eds, y = prop_viable_eggs)) +
  geom_point(color = crab_eggs) +
  theme_gray() +
  geom_smooth(method = lm, level = 0.95, color = "black") +
  ylab("Proportion Viable Crab Eggs") +
  xlab("Egg Development Stage (EDS)") + 
  ggtitle("Egg Mortality Across EDS") +
  theme(plot.title = element_text(hjust = 0.5))

eggs_mort_eds_vis

```


##### - average at eds
```{r}
#plot the data for the dataframe with the averages as groups
eggs_mort_eds_avg_vis <- ggplot(data = eggs_mort_eds_avg, 
       aes(x = eds, y = avg_prop_viable_eggs)) +
  geom_point(color = crab_eggs) +
  theme_gray() +
  geom_smooth(method = lm, level = 0.95, color = "black") +
  ylab("Average Proportion Viable Crab Eggs") +
  xlab("Egg Development Stage (EDS)") + 
  ggtitle("Average Egg Mortality Across EDS") +
  theme(plot.title = element_text(hjust = 0.5))

eggs_mort_eds_avg_vis

```


#### ii) Low Infestation

##### - prop viable eggs 
```{r}
#plot the data for the longer dataframe with the averages as groups
eggs_mort_vis_low_eds <- ggplot(data = low_crab_eds, 
       aes(x = eds, y = prop_viable_eggs)) +
  geom_point(color= low) +
  theme_gray() +
  geom_smooth(method = lm, level = 0.95, color = "black") +
  ylab("Proportion Viable Crab Eggs") +
  xlab("Egg Development Stage (EDS)") + 
  ggtitle(label = "Egg Mortality Across EDS",
          subtitle = "Low Infestation Crabs") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

eggs_mort_vis_low_eds

```


##### - average at eds
```{r}
#plot the data for the longer dataframe with the averages as groups
eggs_mort_vis_low_avg_eds <- ggplot(data = eggs_mort_avg_low_avg_eds, 
       aes(x = eds, y = avg_prop_viable_eggs)) +
  geom_point(color= low) +
  theme_gray() +
  geom_smooth(method = lm, level = 0.95, color = "black") +
  ylab("Average Proportion Viable Crab Eggs") +
  xlab("Egg Development Stage (EDS)") + 
  ggtitle(label = "Average Egg Mortality Across EDS",
          subtitle = "Low Infestation Crabs") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

eggs_mort_vis_low_avg_eds

```



#### iii) High Infestation

##### - prop viable eggs 
```{r}
#plot the data for the longer dataframe with the averages as groups
eggs_mort_vis_high_eds <- ggplot(data = high_crab_eds, 
       aes(x = eds, y = prop_viable_eggs)) +
  geom_point(color = high) +
  theme_gray() +
  geom_smooth(method = lm, level = 0.95, color = "black") +
  ylab("Proportion Viable Crab Eggs") +
  xlab("Egg Development Stage (EDS)") + 
  ggtitle(label = "Egg Mortality Across EDS",
          subtitle = "High Infestation Crabs") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

eggs_mort_vis_high_eds

```


##### - average at eds
```{r}
#plot the data for the longer dataframe with the averages as groups
eggs_mort_vis_high_avg_eds <- ggplot(data = eggs_mort_avg_high_avg_eds, 
       aes(x = eds, y = avg_prop_viable_eggs)) +
  geom_point(color= high) +
  theme_gray() +
  geom_smooth(method = lm, level = 0.95, color = "black") +
  ylab("Average Proportion Viable Crab Eggs") +
  xlab("Egg Development Stage (EDS)") + 
  ggtitle(label = "Average Egg Mortality Across EDS",
          subtitle = "High Infestation Crabs") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

eggs_mort_vis_high_avg_eds

```


#### iv) Combined Plots 

##### - prop viable eggs
```{r}
#plot the data for the longer dataframe with the averages as groups
eggs_mort_vis_both_eds <- ggplot() +
  geom_point(data = high_crab_eds, 
       aes(x = eds, y = prop_viable_eggs), color = high) +
  geom_point(data = low_crab_eds, 
       aes(x = eds, y = prop_viable_eggs), color = low) + 
  theme_gray() +
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  ylab("Proportion Viable Crab Eggs") +
  xlab("Egg Development Stage (EDS)") + 
  ggtitle(label = "Egg Mortality Across EDS",
          subtitle = "Combined Plot") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

eggs_mort_vis_both_eds

```



##### - average at eds 
```{r}
#plot the data for the longer dataframe with the averages as groups
eggs_mort_vis_both_avg_eds <- ggplot() +
  geom_point(data = eggs_mort_avg_high_avg_eds, 
       aes(x = eds, y = avg_prop_viable_eggs), color = high) +
  geom_point(data = eggs_mort_avg_low_avg_eds, 
       aes(x = eds, y = avg_prop_viable_eggs), color = low) + 
  theme_gray() +
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  ylab("Average Proportion Viable Crab Eggs") +
  xlab("Egg Development Stage (EDS)") + 
  ggtitle(label = "Egg Mortality Across EDS",
          subtitle = "Combined Plot") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

eggs_mort_vis_both_avg_eds

```



### b) Egg Mortality Data by Development Day

#### i) All the Crabs (averages)
```{r}
#plot the data for the dataframe with the averages as groups
eggs_mort_day_vis_abline <- ggplot(data = eggs_mort_day_avg, 
       aes(x = day, y = avg_prop_viable_eggs)) +
  geom_point(color= crab_eggs) +
  theme_gray() +
  geom_smooth(method = lm, level = 0.95, color = "black") +
  ylab("Average Proportion Viable Crab Eggs") +
  xlab("Development Day") + 
  ggtitle("Egg Mortality Across Development Days") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_y_continuous(limits = c(0, 1))

#plot the graphs
eggs_mort_day_vis_abline

#plot the data for the dataframe with the averages as groups
eggs_mort_day_vis <- ggplot(data = eggs_mort_day_avg, 
       aes(x = day, y = avg_prop_viable_eggs)) +
  geom_point(color= crab_eggs) +
  theme_gray() +
  ylab("Average Proportion Viable Crab Eggs") +
  xlab("Development Day") + 
  ggtitle("Egg Mortality Across Development Days") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_y_continuous(limits = c(0, 1))

#plot the graphs
eggs_mort_day_vis

```




#### ii) Low Infestation Only (averages)
```{r}
#plot the data for the longer dataframe with the averages as groups with an abline
eggs_mort_vis_low_abline <- ggplot(data = eggs_mort_day_avg_low, 
       aes(x = day, y = avg_prop_viable_eggs)) +
  geom_point(color = crab_eggs) +
  theme_gray() +
  geom_smooth(method = lm, level = 0.95, color = "black") +
  ylab("Average Proportion Viable Crab Eggs") +
  xlab("Development Day") + 
  ggtitle(label = "Average Egg Mortality Across Development Day",
          subtitle = "Low Infestation Crabs") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5)) 

#plot the graph
eggs_mort_vis_low_abline

#plot the data for the longer dataframe with the averages as groups wihtout an abline
eggs_mort_vis_low <- ggplot(data = eggs_mort_day_avg_low, 
       aes(x = day, y = avg_prop_viable_eggs)) +
  geom_point(color = crab_eggs) + 
  theme_gray() +
  ylab("Average Proportion Viable Crab Eggs") +
  xlab("Development Day") + 
  ggtitle(label = "Average Egg Mortality Across Development Day",
          subtitle = "Low Infestation Crabs") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5)) +
  scale_y_continuous(limits = c(0, 1))

#plot the graph
eggs_mort_vis_low

```


#### iii) High Infestation Only (averages)
```{r}
#plot the data for the longer dataframe with the averages as groups with an abline
eggs_mort_vis_high_abline <- ggplot(data = eggs_mort_day_avg_high, 
       aes(x = day, y = avg_prop_viable_eggs)) +
  geom_point(color = crab_eggs) +
  theme_gray() +
  geom_smooth(method = lm, level = 0.95, color = "black") +
  ylab("Average Proportion Viable Crab Eggs") +
  xlab("Development Day") + 
  ggtitle(label = "Average Egg Mortality Across Development Day",
          subtitle = "High Infestation Crabs") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

#plot the graph
eggs_mort_vis_high_abline

#plot the data for the longer dataframe with the averages as groups without an abline
eggs_mort_vis_high <- ggplot(data = eggs_mort_day_avg_high, 
       aes(x = day, y = avg_prop_viable_eggs)) +
  geom_point(color = crab_eggs) +
  theme_gray() +
  ylab("Average Proportion Viable Crab Eggs") +
  xlab("Development Day") + 
  ggtitle(label = "Average Egg Mortality Across Development Day",
          subtitle = "High Infestation Crabs") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5)) +
  scale_y_continuous(limits = c(0, 1))

#plot the graph
eggs_mort_vis_high

```


#### iv) Combined Plot (averages)
```{r}
#plot the data for the low and high infestations 
eggs_mort_vis_both <- ggplot() +
  geom_point(data = eggs_mort_day_avg_high, 
       aes(x = day, y = avg_prop_viable_eggs), color = low) +
  geom_line(data = eggs_mort_day_avg_high, 
       aes(x = day, y = avg_prop_viable_eggs), color = low) +
  geom_point(data = eggs_mort_day_avg_low, 
       aes(x = day, y = avg_prop_viable_eggs), color = high) +
  geom_line(data = eggs_mort_day_avg_low, 
       aes(x = day, y = avg_prop_viable_eggs), color = high) +
  theme_gray() +
  ylab("Average Proportion Viable Crab Eggs") +
  xlab("Development Day") + 
  ggtitle(label = "Average Egg Mortality Across Development Day",
          subtitle = "Low vs. High Infestation") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

eggs_mort_vis_both

```



# 3. Life Stage Timeseries 

## a) Egg Mortality Data

### i) All crabs

#### - by development day
```{r}
#plot the number of adults over time per 1000 host eggs
adult_timeseries <- ggplot(data = timeseries_avg, 
       aes(x = day, y = avg_prop_adults)) +
  geom_point(color = adults) +
  theme_gray() +
  ylab("Adults per One Thousand Host Eggs") +
  xlab("Development Day") + 
  ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 

#plot the number of juveniles over time per 1000 host eggs
juvenile_timeseries <- ggplot(data = timeseries_avg, 
       aes(x = day, y = avg_prop_juveniles)) +
  geom_point(color = juveniles) +
  theme_gray() +
  ylab("Larval per One Thousand Host Eggs") +
  xlab("Development Day") + 
  ggtitle("Larval Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 


#plot the number of nico eggs over time per 1000 host eggs
nico_egg_timeseries <- ggplot(data = timeseries_avg, 
       aes(x = day, y = avg_prop_nico_eggs)) +
  geom_point(color =  nico_eggs) +
  theme_gray() +
  ylab("Nico Eggs per One Thousand Host Eggs") +
  xlab("Development Day") + 
  ggtitle("Nico Eggs") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 


#plot the number of total nicos over time per 1000 host eggs
total_nicos_timeseries <- ggplot(data = timeseries_avg, 
       aes(x = day, y = (avg_prop_total_nicos + avg_prop_nico_eggs))) +
  geom_point(color =  totals) +
  theme_gray() +
  ylab("Total Nicos per One Thousand Host Eggs") +
  xlab("Development Day") + 
  ggtitle("Total Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 

#plot the number of total nicos over time per 1000 host eggs with abline
total_nicos_timeseries_abline <- ggplot(data = timeseries_avg, 
       aes(x = day, y = (avg_prop_total_nicos + avg_prop_nico_eggs))) +
  geom_point(color =  totals) +
  theme_gray() +
  geom_smooth(method = lm, level = 0.95, color = "black") +
  ylab("Total Nicos per One Thousand Host Eggs") +
  xlab("Development Day") + 
  ggtitle("Total Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 

#add the plots together
all_timeseries_day <- ggarrange(adult_timeseries, juvenile_timeseries, total_nicos_timeseries, nico_egg_timeseries,
                           labels = c("a)", "b)", "c)", "d)"),
                           ncol = 2, nrow = 2)

#add a title for the figure 
annotate_figure(all_timeseries_day,
               top = text_grob("Timeseries by Development Day", color = "black", face = "bold", size = 14))


#look at the total nicos with a regression line alone
total_nicos_timeseries_abline

```

#### - by eds
```{r}
#plot the number of adults over time per 1000 host eggs
adult_timeseries_eds <- ggplot(data = timeseries_avg_eds, 
       aes(x = eds, y = avg_prop_adults)) +
  geom_point(color = adults) +
  theme_gray() +
  ylab("Adults per One Thousand Host Eggs") +
  xlab("EDS") + 
  ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 

#plot the number of juveniles over time per 1000 host eggs
juvenile_timeseries_eds <- ggplot(data = timeseries_avg_eds, 
       aes(x = eds, y = avg_prop_juveniles)) +
  geom_point(color = juveniles) +
  theme_gray() +
  ylab("Larval per One Thousand Host Eggs") +
  xlab("EDS") + 
  ggtitle("Larval Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 


#plot the number of nico eggs over time per 1000 host eggs
nico_egg_timeseries_eds <- ggplot(data = timeseries_avg_eds, 
       aes(x = eds, y = avg_prop_nico_eggs)) +
  geom_point(color =  nico_eggs) +
  theme_gray() +
  ylab("Nico Eggs per One Thousand Host Eggs") +
  xlab("Development Day") + 
  ggtitle("Nico Eggs") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 


#plot the number of total nicos over time per 1000 host eggs
total_nicos_timeseries_eds <- ggplot(data = timeseries_avg_eds, 
       aes(x = eds, y = avg_prop_total_nicos)) +
  geom_point(color =  totals) +
  theme_gray() +
  ylab("Total Nicos per One Thousand Host Eggs") +
  xlab("EDS") + 
  ggtitle("Total Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 

#add the plots together
all_timeseries_eds <- ggarrange(adult_timeseries_eds, juvenile_timeseries_eds, total_nicos_timeseries_eds, nico_egg_timeseries_eds,
                           labels = c("a)", "b)", "c)", "d)"),
                           ncol = 2, nrow = 2)

#add a title for the figure 
annotate_figure(all_timeseries_eds,
               top = text_grob("Timeseries by EDS", color = "black", face = "bold", size = 14))

```



### ii) High Infestation Crabs 

#### - by development day 
```{r}
#plot the number of adults over time per 1000 host eggs
adult_timeseries_high <- ggplot(data = high_timeseries_avg, 
       aes(x = day, y = avg_prop_adults)) +
  geom_point(color = adults) +
  theme_gray() +
  ylab("Adults per One Thousand Host Eggs") +
  xlab("Development Day") + 
  ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 

#plot the number of juveniles over time per 1000 host eggs
juvenile_timeseries_high <- ggplot(data = high_timeseries_avg, 
       aes(x = day, y = avg_prop_juveniles)) +
  geom_point(color = juveniles) +
  theme_gray() +
  ylab("Larval per One Thousand Host Eggs") +
  xlab("Development Day") + 
  ggtitle("Larval Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 


#plot the number of nico eggs over time per 1000 host eggs
nico_egg_timeseries_high <- ggplot(data = high_timeseries_avg, 
       aes(x = day, y = avg_prop_nico_eggs)) +
  geom_point(color =  nico_eggs) +
  theme_gray() +
  ylab("Nico Eggs per One Thousand Host Eggs") +
  xlab("Development Day") + 
  ggtitle("Nico Eggs") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 


#plot the number of total nicos over time per 1000 host eggs
total_nicos_timeseries_high <- ggplot(data = high_timeseries_avg, 
       aes(x = day, y = avg_prop_total_nicos)) +
  geom_point(color =  totals) +
  theme_gray() +
  ylab("Total Nicos per One Thousand Host Eggs") +
  xlab("Development Day") + 
  ggtitle("Total Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 

#add the plots together
high_timeseries_day <- ggarrange(adult_timeseries_high, juvenile_timeseries_high, total_nicos_timeseries_high, nico_egg_timeseries_high,
                           labels = c("a)", "b)", "c)", "d)"),
                           ncol = 2, nrow = 2)

#add a title for the figure 
annotate_figure(high_timeseries_day,
               top = text_grob("Timeseries by Development Day", color = "black", face = "bold", size = 14))
  

```

#### - by eds 
```{r}
#plot the number of adults over time per 1000 host eggs
adult_timeseries_high_eds <- ggplot(data = high_timeseries_avg_eds, 
       aes(x = eds, y = avg_prop_adults)) +
  geom_point(color = adults) +
  theme_gray() +
  ylab("Adults per One Thousand Host Eggs") +
  xlab("Development Day") + 
  ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 

#plot the number of juveniles over time per 1000 host eggs
juvenile_timeseries_high_eds <- ggplot(data = high_timeseries_avg_eds, 
       aes(x = eds, y = avg_prop_juveniles)) +
  geom_point(color = juveniles) +
  theme_gray() +
  ylab("Larval per One Thousand Host Eggs") +
  xlab("Development Day") + 
  ggtitle("Larval Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 


#plot the number of nico eggs over time per 1000 host eggs
nico_egg_timeseries_high_eds <- ggplot(data = high_timeseries_avg_eds, 
       aes(x = eds, y = avg_prop_nico_eggs)) +
  geom_point(color =  nico_eggs) +
  theme_gray() +
  ylab("Nico Eggs per One Thousand Host Eggs") +
  xlab("Development Day") + 
  ggtitle("Nico Eggs") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 


#plot the number of total nicos over time per 1000 host eggs
total_nicos_timeseries_high_eds <- ggplot(data = high_timeseries_avg_eds, 
       aes(x = eds, y = avg_prop_total_nicos)) +
  geom_point(color =  totals) +
  theme_gray() +
  ylab("Total Nicos per One Thousand Host Eggs") +
  xlab("Development Day") + 
  ggtitle("Total Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 

#add the plots together
high_timeseries_eds <- ggarrange(adult_timeseries_high_eds, juvenile_timeseries_high_eds, total_nicos_timeseries_high_eds, nico_egg_timeseries_high_eds,
                           labels = c("a)", "b)", "c)", "d)"),
                           ncol = 2, nrow = 2)

#add a title for the figure 
annotate_figure(high_timeseries_eds,
               top = text_grob("Timeseries by EDS", color = "black", face = "bold", size = 14))

```


### iii) Low Infestation Crabs

#### - by development day 
```{r}
#plot the number of adults over time per 1000 host eggs
adult_timeseries_low <- ggplot(data = low_timeseries_avg, 
       aes(x = day, y = avg_prop_adults)) +
  geom_point(color = adults) +
  theme_gray() +
  ylab("Adults per One Thousand Host Eggs") +
  xlab("Development Day") + 
  ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 

#plot the number of juveniles over time per 1000 host eggs
juvenile_timeseries_low <- ggplot(data = low_timeseries_avg, 
       aes(x = day, y = avg_prop_juveniles)) +
  geom_point(color = juveniles) +
  theme_gray() +
  ylab("Larval per One Thousand Host Eggs") +
  xlab("Development Day") + 
  ggtitle("Larval Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 


#plot the number of nico eggs over time per 1000 host eggs
nico_egg_timeseries_low <- ggplot(data = low_timeseries_avg, 
       aes(x = day, y = avg_prop_nico_eggs)) +
  geom_point(color =  nico_eggs) +
  theme_gray() +
  ylab("Nico Eggs per One Thousand Host Eggs") +
  xlab("Development Day") + 
  ggtitle("Nico Eggs") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 


#plot the number of total nicos over time per 1000 host eggs
total_nicos_timeseries_low <- ggplot(data = low_timeseries_avg, 
       aes(x = day, y = avg_prop_total_nicos)) +
  geom_point(color =  totals) +
  theme_gray() +
  ylab("Total Nicos per One Thousand Host Eggs") +
  xlab("Development Day") + 
  ggtitle("Total Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 

#add the plots together
low_timeseries_day <- ggarrange(adult_timeseries_low, juvenile_timeseries_low, total_nicos_timeseries_low, nico_egg_timeseries_low,
                           labels = c("a)", "b)", "c)", "d)"),
                           ncol = 2, nrow = 2)

#add a title for the figure 
annotate_figure(low_timeseries_day,
               top = text_grob("Timeseries by Development Day", color = "black", face = "bold", size = 14))


```


#### - by eds
```{r}
#plot the number of adults over time per 1000 host eggs
adult_timeseries_low_eds <- ggplot(data = low_timeseries_avg_eds, 
       aes(x = eds, y = avg_prop_adults)) +
  geom_point(color = adults) +
  theme_gray() +
  ylab("Adults per One Thousand Host Eggs") +
  xlab("EDS") + 
  ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 

#plot the number of juveniles over time per 1000 host eggs
juvenile_timeseries_low_eds <- ggplot(data = low_timeseries_avg_eds, 
       aes(x = eds, y = avg_prop_juveniles)) +
  geom_point(color = juveniles) +
  theme_gray() +
  ylab("Larval per One Thousand Host Eggs") +
  xlab("EDS") + 
  ggtitle("Larval Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 


#plot the number of nico eggs over time per 1000 host eggs
nico_egg_timeseries_low_eds <- ggplot(data = low_timeseries_avg_eds, 
       aes(x = eds, y = avg_prop_nico_eggs)) +
  geom_point(color =  nico_eggs) +
  theme_gray() +
  ylab("Nico Eggs per One Thousand Host Eggs") +
  xlab("EDS") + 
  ggtitle("Nico Eggs") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 


#plot the number of total nicos over time per 1000 host eggs
total_nicos_timeseries_low_eds <- ggplot(data = low_timeseries_avg_eds, 
       aes(x = eds, y = avg_prop_total_nicos)) +
  geom_point(color =  totals) +
  theme_gray() +
  ylab("Total Nicos per One Thousand Host Eggs") +
  xlab("EDS") + 
  ggtitle("Total Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 

#add the plots together
low_timeseries_eds <- ggarrange(adult_timeseries_low_eds, juvenile_timeseries_low_eds, total_nicos_timeseries_low_eds, nico_egg_timeseries_low_eds,
                           labels = c("a)", "b)", "c)", "d)"),
                           ncol = 2, nrow = 2)

#add a title for the figure 
annotate_figure(low_timeseries_eds,
               top = text_grob("Timeseries by EDS", color = "black", face = "bold", size = 14))

```


## b) Egg Mortality and Autoinfection Data 

### i) All Adults by EDS

##### - old autoinfection

###### -) prop viable eggs 
```{r}
#plot the number of adults over time per 1000 host eggs
adult_timeseries_all <- ggplot(data = adult_all, 
       aes(x = eds, y = prop_adults)) +
  geom_point(color = adults) +
  theme_gray() +
  ylab("Adults per One Thousand Host Eggs") +
  xlab("EDS") + 
  ggtitle(label = "Adult Nicos",
          subtitle = "Old Autoinfection") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        plot.subtitle = element_text(hjust = 0.5))

adult_timeseries_all
  
```

###### -) average
```{r}
#plot the number of adults over time per 1000 host eggs
adult_timeseries_avg_all <- ggplot(data = adult_all_avg, 
       aes(x = eds, y = avg_prop_adults)) +
  geom_point(color = adults) +
  theme_gray() +
  ylab("Average Adults per One Thousand Host Eggs") +
  xlab("EDS") + 
  ggtitle(label = "Adult Nicos",
          subtitle = "Old Autoinfection") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        plot.subtitle = element_text(hjust = 0.5))

adult_timeseries_avg_all
  
```

##### - all broods

###### -) prop viable eggs
```{r}
#plot the number of adults over time per 1000 host eggs
adult_timeseries_all_broods <- ggplot(data = adult_all_broods, 
       aes(x = eds, y = prop_adults)) +
  geom_point(color = adults) +
  theme_gray() +
  ylab("Adults per One Thousand Host Eggs") +
  xlab("EDS") + 
  ggtitle(label = "Adult Nicos",
          subtitle = "All Brood Data") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        plot.subtitle = element_text(hjust = 0.5))

adult_timeseries_all_broods

```

###### -) averages
```{r}
#plot the number of adults over time per 1000 host eggs
adult_timeseries_all_broods_avg <- ggplot(data = adult_all_broods_avg, 
       aes(x = eds, y = avg_prop_adults)) +
  geom_point(color = adults) +
  theme_gray() +
  ylab("Average Adults per One Thousand Host Eggs") +
  xlab("EDS") + 
  ggtitle(label = "Adult Nicos",
          subtitle = "All Brood Data") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        plot.subtitle = element_text(hjust = 0.5))

adult_timeseries_all_broods_avg

```


##### - new autoinfection

###### -) prop viable eggs
```{r}
#plot the number of adults over time per 1000 host eggs
adult_timeseries_all_new <- ggplot(data = adult_all_new, 
       aes(x = eds, y = prop_adults)) +
  geom_point(color = adults) +
  theme_gray() +
  ylab("Adults per One Thousand Host Eggs") +
  xlab("EDS") + 
  ggtitle(label = "Adult Nicos",
          subtitle = "New Autoinfection") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        plot.subtitle = element_text(hjust = 0.5))

adult_timeseries_all_new

```


###### -) averages
```{r}
#plot the number of adults over time per 1000 host eggs
adult_timeseries_all_new_avg <- ggplot(data = adult_all_avg_new, 
       aes(x = eds, y = avg_prop_adults)) +
  geom_point(color = adults) +
  theme_gray() +
  ylab("Average Adults per One Thousand Host Eggs") +
  xlab("EDS") + 
  ggtitle(label = "Adult Nicos",
          subtitle = "New Autoinfection") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        plot.subtitle = element_text(hjust = 0.5))

adult_timeseries_all_new_avg

```


### ii) All Nico Eggs by EDS

##### - old autoinfection

###### -) prop viable eggs 
```{r}
#plot the number of nico eggs over time per 1000 host eggs
nico_egg_timeseries_all <- ggplot(data = nico_egg_all, 
       aes(x = eds, y = prop_nico_eggs)) +
  geom_point(color = nico_eggs) +
  theme_gray() +
  ylab("Nico Eggs per One Thousand Host Eggs") +
  xlab("EDS") + 
  ggtitle(label = "Nico Eggs",
          subtitle = "Old Autoinfection") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        plot.subtitle = element_text(hjust = 0.5))

nico_egg_timeseries_all

```


###### -) averages
```{r}
#plot the number of nico eggs over time per 1000 host eggs
nico_egg_timeseries_all_avg <- ggplot(data = nico_egg_all_avg, 
       aes(x = eds, y = avg_prop_nico_eggs)) +
  geom_point(color = nico_eggs) +
  theme_gray() +
  ylab("Average Nico Eggs per One Thousand Host Eggs") +
  xlab("EDS") + 
  ggtitle(label = "Nico Eggs",
          subtitle = "Old Autoinfection") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        plot.subtitle = element_text(hjust = 0.5))

nico_egg_timeseries_all_avg

```



##### - all broods

###### -) prop viable eggs
```{r}
#plot the number of nico eggs over time per 1000 host eggs
nico_egg_timeseries_all_broods <- ggplot(data = nico_egg_all_broods, 
       aes(x = eds, y = prop_nico_eggs)) +
  geom_point(color = nico_eggs) +
  theme_gray() +
  ylab("Nico Eggs per One Thousand Host Eggs") +
  xlab("EDS") + 
  ggtitle(label = "Nico Eggs",
          subtitle = "All Brood Data") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        plot.subtitle = element_text(hjust = 0.5))

nico_egg_timeseries_all_broods

```

###### -) averages
```{r}
#plot the number of nico eggs over time per 1000 host eggs
nico_egg_timeseries_all_broods_avg <- ggplot(data = nico_egg_all_broods_avg, 
       aes(x = eds, y = avg_prop_nico_eggs)) +
  geom_point(color = nico_eggs) +
  theme_gray() +
  ylab("Average Nico Eggs per One Thousand Host Eggs") +
  xlab("EDS") + 
  ggtitle(label = "Nico Eggs",
          subtitle = "All Brood Data") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        plot.subtitle = element_text(hjust = 0.5))

nico_egg_timeseries_all_broods_avg

```



##### - new autoinfection

###### -) prop viable eggs
```{r}
#plot the number of nico eggs over time per 1000 host eggs
nico_egg_timeseries_all_new <- ggplot(data = nico_egg_all_new, 
       aes(x = eds, y = prop_nico_eggs)) +
  geom_point(color = nico_eggs) +
  theme_gray() +
  ylab("Nico Eggs per One Thousand Host Eggs") +
  xlab("EDS") + 
  ggtitle(label = "Nico Eggs",
          subtitle = "New Autoinfection") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        plot.subtitle = element_text(hjust = 0.5))

nico_egg_timeseries_all_new

```

###### -) averages
```{r}
#plot the number of nico eggs over time per 1000 host eggs
nico_egg_timeseries_all_new_avg <- ggplot(data = nico_egg_all_avg_new, 
       aes(x = eds, y = avg_prop_nico_eggs)) +
  geom_point(color = nico_eggs) +
  theme_gray() +
  ylab("Average Nico Eggs per One Thousand Host Eggs") +
  xlab("EDS") + 
  ggtitle(label = "Nico Eggs",
          subtitle = "New Autoinfection") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        plot.subtitle = element_text(hjust = 0.5))

nico_egg_timeseries_all_new_avg

```


### iii) Comparision Plots

##### - first vs. all broods (averages)
```{r}
#add the plots together
brood_choices <- ggarrange(adult_timeseries_all, adult_timeseries_all_broods, nico_egg_timeseries_all, nico_egg_timeseries_all_broods,
                           labels = c("a)", "b)", "c)", "d)"),
                           ncol = 2, nrow = 2)

#add a title for the figure 
annotate_figure(brood_choices,
               top = text_grob("First Brood vs. All Broods", color = "black", face = "bold", size = 14))

```

##### - old vs. new autoinfection (averages)
```{r}
#add the plots together
autoinfection_choices <- ggarrange(adult_timeseries_all, adult_timeseries_all_new, nico_egg_timeseries_all, nico_egg_timeseries_all_new,
                           labels = c("a)", "b)", "c)", "d)"),
                           ncol = 2, nrow = 2)

#add a title for the figure 
annotate_figure(autoinfection_choices,
               top = text_grob("Old Autoinfection vs. New Autoinfection", color = "black", face = "bold", size = 14))

```



### iv) All Adults by Day

##### - new autoinfection

###### -) prop viable eggs
```{r}
#plot the number of adults over time per 1000 host eggs
adult_timeseries_all_new_day <- ggplot(data = adult_all_new, 
       aes(x = day, y = prop_adults)) +
  geom_point(color = adults) +
  theme_gray() +
  ylab("Adults per One Thousand Host Eggs") +
  xlab("Development Day") + 
  ggtitle(label = "Adult Nicos",
          subtitle = "New Autoinfection") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        plot.subtitle = element_text(hjust = 0.5))

adult_timeseries_all_new_day

```

###### -) averages 
```{r}
#plot the number of adults over time per 1000 host eggs
adult_timeseries_all_new_day_avg <- ggplot(data = adult_all_avg_new_day, 
       aes(x = day, y = avg_prop_adults)) +
  geom_point(color = adults) +
  theme_gray() +
  ylab("Average Adults per One Thousand Host Eggs") +
  xlab("Development Day") + 
  ggtitle(label = "Adult Nicos",
          subtitle = "New Autoinfection") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        plot.subtitle = element_text(hjust = 0.5))

adult_timeseries_all_new_day_avg


```


### v) All Nico Eggs by Day

##### - new autoinfection

###### -) prop viable eggs
```{r}
#plot the number of nico eggs over time per 1000 host eggs
nico_egg_timeseries_all_new_day <- ggplot(data = nico_egg_all_new, 
       aes(x = day, y = prop_nico_eggs)) +
  geom_point(color = nico_eggs) +
  theme_gray() +
  ylab("Nico Eggs per One Thousand Host Eggs") +
  xlab("Development Day") + 
  ggtitle(label = "Nico Eggs",
          subtitle = "New Autoinfection") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        plot.subtitle = element_text(hjust = 0.5))

nico_egg_timeseries_all_new_day

```


###### -) averages
```{r}
#plot the number of nico eggs over time per 1000 host eggs
nico_egg_timeseries_all_new_day_avg <- ggplot(data = nico_egg_all_avg_new_day, 
       aes(x = day, y = avg_prop_nico_eggs)) +
  geom_point(color = nico_eggs) +
  theme_gray() +
  ylab("Average Nico Eggs per One Thousand Host Eggs") +
  xlab("Development Day") + 
  ggtitle(label = "Nico Eggs",
          subtitle = "New Autoinfection") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        plot.subtitle = element_text(hjust = 0.5))

nico_egg_timeseries_all_new_day_avg

```


## c) Timeseries for ANT-GAV-009
```{r}
#create a dataframe for just ANT-GAV-009 by eds
ant_gav_009 <- all_broods %>%
  filter(crab_id %in% c("ANT-GAV-009", "ANT-GAV-009.2", "ANT-GAV-009.3", "ANT-GAV-009.4"))  %>%
  mutate(prop_adults = (number_of_adult_copepods/total_number_of_eggs)*1000) %>%
  mutate(prop_nico_eggs = (number_of_copepod_eggs/total_number_of_eggs)*1000) %>%
  rename(eds = egg_development_stage)

#create a dataframe with the averages per eds
ant_gav_009_avg <- ant_gav_009 %>%
  group_by(eds) %>%
  summarize(avg_prop_adults = mean(prop_adults),
            avg_prop_nico_eggs = mean(prop_nico_eggs)) %>%
  as_tibble()
  
#plot the number of adults over eds per 1000 host eggs
adult_timeseries_009 <- ggplot(data = ant_gav_009_avg, 
       aes(x = eds, y = avg_prop_adults)) +
  geom_point(color = adults) +
  theme_gray() +
  ylab("Adults per One Thousand Host Eggs") +
  xlab("EDS") + 
  ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5))

adult_timeseries_009

#plot the number of nico eggs over eds per 1000 host eggs
nico_egg_timeseries_009 <- ggplot(data = ant_gav_009_avg, 
       aes(x = eds, y = avg_prop_nico_eggs)) +
  geom_point(color = nico_eggs) +
  theme_gray() +
  ylab("Nico per One Thousand Host Eggs") +
  xlab("EDS") + 
  ggtitle("Nico Eggs") +
  theme(plot.title = element_text(hjust = 0.5))
  
nico_egg_timeseries_009



#create a dataframe with the averages per brood (crab_id)
ant_gav_009_brood <- ant_gav_009 %>%
  group_by(crab_id, eds) %>%
  summarize(avg_prop_adults = mean(prop_adults),
            avg_prop_nico_eggs = mean(prop_nico_eggs)) %>%
  as_tibble()
  
#plot the number of adults over eds per 1000 host eggs
adult_timeseries_009 <- ggplot(data = ant_gav_009_brood, 
       aes(x = eds, y = avg_prop_adults, group = crab_id)) +
  geom_point(aes(color = crab_id)) +
  geom_line(aes(color = crab_id)) +
  theme_gray() +
  ylab("Adults per One Thousand Host Eggs") +
  xlab("EDS") + 
  ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5))

adult_timeseries_009

#plot the number of nico eggs over eds per 1000 host eggs
nico_egg_timeseries_009 <- ggplot(data = ant_gav_009_brood, 
       aes(x = eds, y = avg_prop_nico_eggs, group = crab_id)) +
  geom_point(aes(color = crab_id))+
  geom_line(aes(color = crab_id)) +
  theme_gray() +
  ylab("Nico per One Thousand Host Eggs") +
  xlab("EDS") + 
  ggtitle("Nico Eggs") +
  theme(plot.title = element_text(hjust = 0.5))
  
nico_egg_timeseries_009
  
```


## d) Test for High vs. Low 
```{r}
#high infestation crabs
high_crab_id <- egg_mortality_day %>%
  filter(number_adult_nicos >= 20 | number_juvenile_nicos >= 120)

#low infestation crabs 
low_crab_id <- egg_mortality_day %>%
  filter(number_adult_nicos < 20) %>%
  filter(number_juvenile_nicos < 120)
  
```



## e) Publication Timeseries

### i) Adults 

#### -by day 
```{r}
#plot the number of adults over time per 1000 host eggs
timeseries_adult <- ggplot() +
  geom_line(data = adult_all_avg_new_day,
            aes(x = day, y = max_scaled_adults)) +
  geom_line(data = adult_all_avg_new_day,
            aes(x = day, y = min_scaled_adults)) +
  geom_ribbon(data = adult_all_avg_new_day,
              aes(x = day, 
                  ymin = min_scaled_adults,
                  ymax = max_scaled_adults),
              fill = "gray",
              alpha = 0.4) +
  geom_point(data = adult_all_avg_new_day,
            aes(x = day, y = scaled_adults), color = adults) +
  theme_gray() +
  ylab("Adult Nicothoids per One Million Crab Eggs") +
  xlab("Development Day") + 
  #ggtitle(label = "Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

timeseries_adult


#plot the number of adults over time per 1000 host eggs
adult_timeseries_all_new_day <- ggplot() +
  geom_point(data = adult_all_new,
            aes(x = day, y = scaled_adults), color = adults) +
  theme_gray() +
  ylab("Adult Nicothoids per One Million Crab Eggs") +
  xlab("Development Day") + 
  #ggtitle(label = "Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

adult_timeseries_all_new_day

```

#### -by eds
```{r}
#plot the number of nico eggs over time per 1000 host eggs
eds_adults <- ggplot() +
  geom_point(data = adult_all_avg_new,
            aes(x = eds, y = max_scaled_adults), color = "blue") +
  geom_point(data = adult_all_avg_new,
            aes(x = eds, y = min_scaled_adults), color = "green") +
  #geom_ribbon(data = adult_all_avg_new,
              #aes(x = eds, 
                  #ymin = min_scaled_adults,
                  #ymax = max_scaled_adults),
              #fill = "gray",
              #alpha = 0.4) +
  geom_point(data = adult_all_avg_new,
            aes(x = eds, y = avg_scaled_adults), color = adults) +
  theme_gray() +
  ylab("Average Adult Nicothoids per One Million Crab Eggs") +
  xlab("Egg Development Stgae") + 
  #ggtitle(label = "Nico Eggs") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

eds_adults

```




### ii) Juveniles

#### -by day 
```{r}
#plot the number of juveniles over time per one million host eggs
timeseries_juveniles <- ggplot() +
  geom_line(data = timeseries_avg,
            aes(x = day, y = max_scaled_juveniles)) +
  geom_line(data = timeseries_avg,
            aes(x = day, y = min_scaled_juveniles)) +
  geom_ribbon(data = timeseries_avg,
              aes(x = day, 
                  ymin = min_scaled_juveniles,
                  ymax = max_scaled_juveniles),
              fill = "gray",
              alpha = 0.4) +
  geom_point(data = timeseries_avg,
            aes(x = day, y = scaled_juveniles), color = adults) +
  theme_gray() +
  ylab("Larval Nicothoids per One Million Crab Eggs") +
  xlab("Development Day") + 
  #ggtitle(label = "Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

timeseries_juveniles

#plot the number of juvniles over time per one million host eggs
juvenile_timeseries_all_counts <- ggplot() +
  geom_point(data = timeseries,
            aes(x = day, y = scaled_juveniles), color = adults) +
  theme_gray() +
  ylab("Larval Nicothoids per One Million Crab Eggs") +
  xlab("Development Day") + 
  #ggtitle(label = "Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

juvenile_timeseries_all_counts


```


### iii) Total Nicos

#### -by day 
```{r}
#plot the number of total nicos over time per one million host eggs
timeseries_total_nicos <- ggplot() +
  geom_line(data = timeseries_avg,
            aes(x = day, y = max_scaled_total_nicos)) +
  geom_line(data = timeseries_avg,
            aes(x = day, y = min_scaled_total_nicos)) +
  geom_ribbon(data = timeseries_avg,
              aes(x = day, 
                  ymin = min_scaled_total_nicos,
                  ymax = max_scaled_total_nicos),
              fill = "gray",
              alpha = 0.4) +
  geom_point(data = timeseries_avg,
            aes(x = day, y = scaled_total_nicos), color = adults) +
  theme_gray() +
  ylab("Total Nicothoids per One Million Crab Eggs") +
  xlab("Development Day") + 
  #ggtitle(label = "Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

timeseries_total_nicos

#plot the number of juvniles over time per one million host eggs
total_nicos_timeseries_all_counts <- ggplot() +
  geom_point(data = timeseries,
            aes(x = day, y = scaled_total_nicos), color = adults) +
  theme_gray() +
  ylab("Total Nicothoids per One Million Crab Eggs") +
  xlab("Development Day") + 
  #ggtitle(label = "Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

total_nicos_timeseries_all_counts


```

### iv) Nico Eggs

#### -by day 
```{r}
#plot the number of nico eggs over time per 1000 host eggs
timeseries_nico_eggs <- ggplot() +
  geom_line(data = nico_egg_all_avg_new_day,
            aes(x = day, y = max_scaled_nico_eggs)) +
  geom_line(data = nico_egg_all_avg_new_day,
            aes(x = day, y = min_scaled_nico_eggs)) +
  geom_ribbon(data = nico_egg_all_avg_new_day,
              aes(x = day, 
                  ymin = min_scaled_nico_eggs,
                  ymax = max_scaled_nico_eggs),
              fill = "gray",
              alpha = 0.4) +
  geom_point(data = nico_egg_all_avg_new_day,
            aes(x = day, y = scaled_nico_eggs), color = adults) +
  theme_gray() +
  ylab("Nicothoids Eggs per One Million Crab Eggs") +
  xlab("Development Day") + 
  #ggtitle(label = "Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

timeseries_nico_eggs

#plot the number of nico eggs over time per 1000 host eggs
nico_egg_timeseries_all_new_day <- ggplot(data = nico_egg_all_new, 
       aes(x = day, y = scaled_nico_eggs)) +
  geom_point(color = adults) +
  theme_gray() +
  ylab("Nicothoid Eggs per One Million Crab Eggs") +
  xlab("Development Day") + 
  #ggtitle(label = "Nico Eggs") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

nico_egg_timeseries_all_new_day

```


#### -by eds
```{r}
#plot the number of nico eggs over time per 1000 host eggs
eds_nico_eggs <- ggplot() +
  geom_point(data = nico_egg_all_avg_new,
            aes(x = eds, y = max_scaled_nico_eggs), color = "blue") +
  geom_point(data = nico_egg_all_avg_new,
            aes(x = eds, y = min_scaled_nico_eggs), color = "green") +
  #geom_ribbon(data = nico_egg_all_avg_new,
              #aes(x = eds, 
                  #ymin = min_scaled_nico_eggs,
                  #ymax = max_scaled_nico_eggs),
              #fill = "gray",
              #alpha = 0.4) +
  geom_point(data = nico_egg_all_avg_new,
            aes(x = eds, y = avg_scaled_nico_eggs), color = adults) +
  theme_gray() +
  ylab("Average Nicothoid Eggs per One Million Crab Eggs") +
  xlab("Egg Development Stgae") + 
  #ggtitle(label = "Nico Eggs") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

eds_nico_eggs


```


### v) Combined Life Stage Plot 

#### - by day 
```{r}
#plot the number of total nicos over time per one million host eggs
timeseries_all <- ggplot(data = timeseries_avg) +
  geom_point(data = timeseries_avg,
            aes(x = day, y = avg_prop_adults), color = adults) +
  geom_point(data = timeseries_avg,
            aes(x = day, y = avg_prop_juveniles/10), color = juveniles) +
  geom_point(data = timeseries_avg,
            aes(x = day, y = avg_prop_nico_eggs/10), color = "pink") +
  scale_y_continuous(name = "Adult Abundance", 
                     sec.axis = sec_axis(~ . *10, name = "Larvae and Nico Egg Abundance")) +
  theme_gray() +
  xlab("Development Day") + 
  #ggtitle(label = "Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

timeseries_all


```


#### - by eds 
```{r}
#plot the number of total nicos over time per one million host eggs
timeseries_all_eds <- ggplot(data = timeseries_avg_eds) +
  geom_point(data = timeseries_avg_eds,
            aes(x = eds, y = avg_prop_adults), color = adults) +
  geom_point(data = timeseries_avg_eds,
            aes(x = eds, y = avg_prop_juveniles/10), color = juveniles) +
  geom_point(data = timeseries_avg_eds,
            aes(x = eds, y = avg_prop_nico_eggs/10), color = "pink") +
  scale_y_continuous(name = "Adult Abundance", 
                     sec.axis = sec_axis(~ . *10, name = "Larvae and Nico Egg Abundance")) +
  theme_gray() +
  xlab("Development Day") + 
  #ggtitle(label = "Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

timeseries_all_eds


```


# 3. Counts Visualization

## a) Normal Counts

#### i) Plot the Counts
```{r}
#plot the number of adult nicos against the total number of viable eggs
adult_plot <- ggplot(data = egg_mortality, 
       aes( y = asin(sqrt(prop_viable_eggs)), x = number_adult_nicos)) +
  geom_point(data = egg_mortality, 
             aes(color = color)) + 
  scale_color_manual(labels = c("D-F", "G-I", "J-L"),
                     values = c("darkgoldenrod1" = "darkgoldenrod1",
                               "coral2" = "coral2",
                               "brown4" = "brown4")) +
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Adult Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        legend.position = "none") +
  guides(color = guide_legend("EDS"))

#plot the number of juvenile nicos against the total number of viable eggs 
juvenile_plot <- ggplot(data = egg_mortality, 
       aes(y = asin(sqrt(prop_viable_eggs)), x = number_juvenile_nicos)) +
  geom_point(data = egg_mortality, 
             aes(color = color)) + 
  scale_color_manual(labels = c("D-F", "G-I", "J-L"),
                     values = c("darkgoldenrod1" = "darkgoldenrod1",
                               "coral2" = "coral2",
                               "brown4" = "brown4")) +
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Larval Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Larval Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        legend.position = "none") 

#plot the number of total number of nicos against the total number of viable eggs
total_plot <- ggplot(data = egg_mortality, 
       aes( y = asin(sqrt(prop_viable_eggs)), x = total_nicos)) +
  geom_point(data = egg_mortality, 
             aes(color = color)) + 
  scale_color_manual(labels = c("D-F", "G-I", "J-L"),
                     values = c("darkgoldenrod1" = "darkgoldenrod1",
                               "coral2" = "coral2",
                               "brown4" = "brown4")) +
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Total Number of Nicos (Larvae/Adults)") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Total Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        legend.position = "none")


#plot the number of nico eggs against the total number of viable eggs
nico_egg_plot <- ggplot(data = egg_mortality, 
       aes(y = asin(sqrt(prop_viable_eggs)), x = number_nico_eggs)) +
  geom_point(data = egg_mortality, 
             aes(color = color)) + 
  scale_color_manual(labels = c("D-F", "G-I", "J-L"),
                     values = c("darkgoldenrod1" = "darkgoldenrod1",
                               "coral2" = "coral2",
                               "brown4" = "brown4")) +
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Nico Eggs") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Nico Eggs") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        legend.position = "none") 
  
#add the plots together
non_transformed <- ggarrange(adult_plot, juvenile_plot, total_plot, nico_egg_plot,
                           labels = c("a)", "b)", "c)", "d)"),
                           ncol = 2, nrow = 2, 
                           common.legend = TRUE, legend="bottom")
#add a title for the figure 
annotate_figure(non_transformed,
               top = text_grob("Non-Transformed Data", color = "black", face = "bold", size = 14))


## we see that there is a clear relationship between the proportion of nonviable eggs and the number of nico eggs while there isn't always this clear relationship with the total number of nicos and the proportion of nonviable eggs
## this is why I want to do things in terms of biomass because the adult nicos are transforming the crab egg biomass directly into nico egg biomass
```

#### ii) Evaluate the Best Transformation
```{r}
#use the Tukey’s Ladder of Powers transformation test to evaluate which transformation is best

##evaluate the Tukey test for the proportion of viable host eggs
transformTukey(egg_mortality$prop_viable_eggs,
                     plotit = FALSE)

##evaluate the Tukey test for the number of adult nicos
transformTukey(egg_mortality$number_adult_nicos,
                     plotit = FALSE)

##evaluate the Tukey test for the number of juvenile nicos
transformTukey(egg_mortality$number_juvenile_nicos,
                     plotit = FALSE)

##evaluate the Tukey test for the number of total nicos
transformTukey(egg_mortality$total_nicos,
                     plotit = FALSE)

##evaluate the Tukey test for the number of nico eggs
transformTukey(egg_mortality$number_nico_eggs,
                     plotit = FALSE)

```

#### iii) Test the Recommended Transformation 
```{r}
#test the suggestions from above
##the lambda is close enough to zero that we can try a log transformation 
egg_mortality_trans <- egg_mortality %>%
  mutate(trans_prop_viable_eggs = prop_viable_eggs^(9.975)) %>%
  mutate(trans_adult_nicos = number_adult_nicos^(0.275)) %>%
  mutate(trans_juvenile_nicos = number_juvenile_nicos^(0.2)) %>%
  mutate(trans_total_nicos = total_nicos^(0.2)) %>%
  mutate(trans_nico_eggs = number_nico_eggs^(0.2)) 


#plot the number of adult nicos against the total number of viable eggs
adult_plot_trans <- ggplot(data = egg_mortality_trans, 
       aes(y = trans_prop_viable_eggs, x = trans_adult_nicos)) +
  geom_point(color = adults) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Adult Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8))

#plot the number of juvenile nicos against the total number of viable eggs 
juvenile_plot_trans <- ggplot(data = egg_mortality_trans, 
       aes(y = trans_prop_viable_eggs, x = trans_juvenile_nicos)) +
  geom_point(color = juveniles) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Larval Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Larval Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 

#plot the number of total number of nicos against the total number of viable eggs
total_plot_trans <- ggplot(data = egg_mortality_trans, 
       aes(y = trans_prop_viable_eggs, x = trans_total_nicos)) +
  geom_point(color = totals) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Total Number of Nicos (Larvae/Adults)") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Total Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8))


#plot the number of nico eggs against the total number of viable eggs
nico_egg_plot_trans <- ggplot(data = egg_mortality_trans, 
       aes(y = trans_prop_viable_eggs, x = trans_nico_eggs)) +
  geom_point(color = nico_eggs) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Nico Eggs") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Nico Eggs") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 
  
#add the plots together
ggarrange(adult_plot_trans, juvenile_plot_trans, total_plot_trans, nico_egg_plot_trans,
                           labels = c("a)", "b)", "c)", "d)"),
                           ncol = 2, nrow = 2)


```





#### v) Ratios 
```{r}
#plot the data for the dataframe with the averages as groups
ratio_viable_eggs <- ggplot(data = timeseries_avg, 
       aes(x = day, y = (avg_prop_nico_eggs/avg_prop_viable_eggs))) +
  geom_point(color = adults) +
  theme_gray() +
  geom_smooth(method = lm, level = 0.95, color = "black") +
  ylab("Ratio of Nicothoid Eggs to Viable Host Eggs") +
  xlab("Development Day") + 
  #ggtitle("Egg Mortality Across Development Days") +
  theme(plot.title = element_text(hjust = 0.5)) 

ratio_viable_eggs

#high infestation with ratios
ratio_viable_eggs_high <- ggplot(data = high_timeseries_avg, 
       aes(x = day, y = (avg_prop_nico_eggs/avg_prop_viable_eggs))) +
  geom_point(color = high) +
  theme_gray() +
  geom_smooth(method = lm, level = 0.95, color = "black") +
  ylab("Ratio of Nicothoid Eggs to Viable Host Eggs") +
  xlab("Development Day") + 
  #ggtitle("Egg Mortality Across Development Days") +
  theme(plot.title = element_text(hjust = 0.5)) 

ratio_viable_eggs_high

#low infestation with ratios
ratio_viable_eggs_low <- ggplot(data = low_timeseries_avg, 
       aes(x = day, y = (avg_prop_nico_eggs/avg_prop_viable_eggs))) +
  geom_point(color = high) +
  theme_gray() +
  geom_smooth(method = lm, level = 0.95, color = "black") +
  ylab("Ratio of Nicothoid Eggs to Viable Host Eggs") +
  xlab("Development Day") + 
  #ggtitle("Egg Mortality Across Development Days") +
  theme(plot.title = element_text(hjust = 0.5)) 

ratio_viable_eggs_low

```


## b) Log Transform the Counts

#### i) All the Crabs

##### - logit transform the proportions
```{r}
##color by the egg development stages
#plot the number of adult nicos against the total number of viable eggs
adult_plot_logit <- ggplot(data = egg_mortality_log, 
       aes(y = log((prop_viable_eggs)/(1- prop_viable_eggs)), x = log_adult_nicos)) +
  geom_point(data = egg_mortality_log, 
             aes(color = color))  + 
  scale_color_manual(labels = c("J-L", "G-I", "D-F"),
                     values = c("darkgoldenrod1" = "darkgoldenrod1",
                               "coral2" = "coral2",
                               "brown4" = "brown4")) +
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Adult Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        legend.position = "none")

#plot the number of juvenile nicos against the total number of viable eggs 
juvenile_plot_logit <- ggplot(data = egg_mortality_log, 
       aes(y = log((prop_viable_eggs)/(1- prop_viable_eggs)), x = log_juvenile_nicos)) +
  geom_point(data = egg_mortality_log, 
             aes(color = color))  + 
  scale_color_manual(labels = c("J-L", "G-I", "D-F"),
                     values = c("darkgoldenrod1" = "darkgoldenrod1",
                               "coral2" = "coral2",
                               "brown4" = "brown4")) +
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Larval Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Larval Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        legend.position = "none") 

#plot the number of total number of nicos against the total number of viable eggs
total_plot_logit <- ggplot(data = egg_mortality_log, 
       aes( y = log((prop_viable_eggs)/(1- prop_viable_eggs)), x = log_total_nicos)) +
  geom_point(data = egg_mortality_log, 
             aes(color = color))  + 
  scale_color_manual(labels = c("J-L", "G-I", "D-F"),
                     values = c("darkgoldenrod1" = "darkgoldenrod1",
                               "coral2" = "coral2",
                               "brown4" = "brown4")) +
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Total Number of Nicos (Larvae/Adults)") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Total Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        legend.position = "none")


#plot the number of nico eggs against the total number of viable eggs
nico_egg_plot_logit <- ggplot(data = egg_mortality_log, 
       aes(y = log((prop_viable_eggs)/(1- prop_viable_eggs)), x = log_nico_eggs)) +
  geom_point(data = egg_mortality_log, 
             aes(color = color))  + 
  scale_color_manual(labels = c("J-L", "G-I", "D-F"),
                     values = c("darkgoldenrod1" = "darkgoldenrod1",
                               "coral2" = "coral2",
                               "brown4" = "brown4")) +
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Nico Eggs") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Nico Eggs") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        legend.position = "none") 
  
#add the plots together
log_transformed_logit <- ggarrange(adult_plot_logit, juvenile_plot_logit, total_plot_logit, nico_egg_plot_logit,
                           labels = c("a)", "b)", "c)", "d)"),
                           ncol = 2, nrow = 2, 
                           common.legend = TRUE, legend="bottom")

#create a title 
log_transformed_logit_title <- expression(atop(bold("Log Transformed Counts:"), scriptstyle("Logit Transformed Proportions")))

#add a title for the figure 
annotate_figure(log_transformed_logit,
               top = text_grob(log_transformed_logit_title))

```

##### - arcsine transform the proportions
```{r}
#plot the number of adult nicos against the total number of viable eggs
adult_plot_logasin <- ggplot(data = egg_mortality_log, 
       aes(y = asin(sqrt(prop_viable_eggs)), x = log_adult_nicos)) +
  geom_point(data = egg_mortality_log, 
             aes(color = color))  + 
  scale_color_manual(labels = c("J-L", "G-I", "D-F"),
                     values = c("darkgoldenrod1" = "darkgoldenrod1",
                               "coral2" = "coral2",
                               "brown4" = "brown4")) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Adult Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        legend.position = "none")

#plot the number of juvenile nicos against the total number of viable eggs 
juvenile_plot_logasin <- ggplot(data = egg_mortality_log, 
       aes(y = asin(sqrt(prop_viable_eggs)), x = log_juvenile_nicos)) +
  geom_point(data = egg_mortality_log, 
             aes(color = color))  + 
  scale_color_manual(labels = c("J-L", "G-I", "D-F"),
                     values = c("darkgoldenrod1" = "darkgoldenrod1",
                               "coral2" = "coral2",
                               "brown4" = "brown4")) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Larval Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Larval Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        legend.position = "none") 

#plot the number of total number of nicos against the total number of viable eggs
total_plot_logasin <- ggplot(data = egg_mortality_log, 
       aes( y = asin(sqrt(prop_viable_eggs)), x = log_total_nicos)) +
  geom_point(data = egg_mortality_log, 
             aes(color = color))  + 
  scale_color_manual(labels = c("J-L", "G-I", "D-F"),
                     values = c("darkgoldenrod1" = "darkgoldenrod1",
                               "coral2" = "coral2",
                               "brown4" = "brown4")) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Total Number of Nicos (Larvae/Adults)") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Total Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        legend.position = "none")


#plot the number of nico eggs against the total number of viable eggs
nico_egg_plot_logasin <- ggplot(data = egg_mortality_log, 
       aes(y = asin(sqrt(prop_viable_eggs)), x = log_nico_eggs)) +
  geom_point(data = egg_mortality_log, 
             aes(color = color))  + 
  scale_color_manual(labels = c("J-L", "G-I", "D-F"),
                     values = c("darkgoldenrod1" = "darkgoldenrod1",
                               "coral2" = "coral2",
                               "brown4" = "brown4")) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Nico Eggs") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Nico Eggs") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        legend.position = "none") 
  
#add the plots together
log_transformed_logasin <- ggarrange(adult_plot_logasin, juvenile_plot_logasin, total_plot_logasin, nico_egg_plot_logasin,
                           labels = c("a)", "b)", "c)", "d)"),
                           ncol = 2, nrow = 2, 
                           common.legend = TRUE, legend ="bottom")

#create a title 
log_transformed_asin_title <- expression(atop(bold("Log Transformed Counts:"), scriptstyle("Arcsine Transformed Proportions")))

#add a title for the figure 
annotate_figure(log_transformed_logasin,
               top = text_grob(log_transformed_asin_title))

```


#### ii) Low Infestation 
```{r}
#plot the number of adult nicos against the total number of viable eggs 
adult_plot_log_low <- ggplot() +
  geom_point(data = egg_mortality_log_low, 
       aes(y = prop_viable_eggs, x = log_adult_nicos), color = low) +
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Adult Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8))

#plot the number of juvenile nicos against the total number of viable eggs 
juvenile_plot_log_low <- ggplot() +
  geom_point(data = egg_mortality_log_low, 
       aes(y = prop_viable_eggs, x = log_juvenile_nicos), color = low) +
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Larval Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Larval Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 

#plot the number of total number of nicos against the total number of viable eggs
total_plot_log_low <- ggplot() +
  geom_point(data = egg_mortality_log_low, 
       aes(y = prop_viable_eggs, x = log_total_nicos), color = low) +
  geom_point(color = totals) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Total Number of Nicos (Larvae/Adults)") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Total Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8))


#plot the number of nico eggs against the total number of viable eggs
nico_egg_plot_log_low <- ggplot() +
  geom_point(data = egg_mortality_log_low, 
       aes(y = prop_viable_eggs, x = log_nico_eggs), color = low) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Nico Eggs") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Nico Eggs") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 
  
#add the plots together
log_transformed_low <- ggarrange(adult_plot_log_low, juvenile_plot_log_low, total_plot_log_low, nico_egg_plot_log_low,
                           labels = c("a)", "b)", "c)", "d)"),
                           ncol = 2, nrow = 2)

#add a title for the figure 
annotate_figure(log_transformed_low,
               top = text_grob("Log-Transformed Data (Low Infestation)", color = "black", face = "bold", size = 14))


```


#### iii) High Infestation
```{r}
#plot the number of adult nicos against the total number of viable eggs 
adult_plot_log_high <- ggplot() +
  geom_point(data = egg_mortality_log_high, 
       aes(y = prop_viable_eggs, x = log_adult_nicos), color = high) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Adult Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8))

#plot the number of juvenile nicos against the total number of viable eggs 
juvenile_plot_log_high <- ggplot() +
  geom_point(data = egg_mortality_log_high, 
       aes(y = prop_viable_eggs, x = log_juvenile_nicos), color = high) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Larval Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Larval Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 

#plot the number of total number of nicos against the total number of viable eggs
total_plot_log_high <- ggplot() +
  geom_point(data = egg_mortality_log_high, 
       aes(y = prop_viable_eggs, x = log_total_nicos), color = high) + 
  geom_point(color = totals) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Total Number of Nicos (Larvae/Adults)") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Total Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8))


#plot the number of nico eggs against the total number of viable eggs
nico_egg_plot_log_high <- ggplot() +
  geom_point(data = egg_mortality_log_high, 
       aes(y = prop_viable_eggs, x = log_nico_eggs), color = high) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Nico Eggs") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Nico Eggs") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 
  
#add the plots together
log_transformed_high <- ggarrange(adult_plot_log_high, juvenile_plot_log_high, total_plot_log_high, nico_egg_plot_log_high,
                           labels = c("a)", "b)", "c)", "d)"),
                           ncol = 2, nrow = 2)

#add a title for the figure 
annotate_figure(log_transformed_high,
               top = text_grob("Log-Transformed Data (High Infestation)", color = "black", face = "bold", size = 14))


```




#### iv) Combined Plots 
```{r}
#plot the number of adult nicos against the total number of viable eggs 
adult_plot_log_both <- ggplot() +
  geom_point(data = egg_mortality_log_low, 
       aes(y = prop_viable_eggs, x = log_adult_nicos), color = low) + 
  geom_point(data = egg_mortality_log_high, 
       aes(y = prop_viable_eggs, x = log_adult_nicos), color = high) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Adult Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8))

#plot the number of juvenile nicos against the total number of viable eggs 
juvenile_plot_log_both <- ggplot() +
  geom_point(data = egg_mortality_log_low, 
       aes(y = prop_viable_eggs, x = log_juvenile_nicos), color = low) + 
  geom_point(data = egg_mortality_log_high, 
       aes(y = prop_viable_eggs, x = log_juvenile_nicos), color = high) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Larval Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Larval Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 

#plot the number of total number of nicos against the total number of viable eggs
total_plot_log_both <- ggplot() +
  geom_point(data = egg_mortality_log_low, 
       aes(y = prop_viable_eggs, x = log_total_nicos), color = low) + 
  geom_point(data = egg_mortality_log_high, 
       aes(y = prop_viable_eggs, x = log_total_nicos), color = high) + 
  geom_point(color = totals) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Total Number of Nicos (Larvae/Adults)") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Total Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8))


#plot the number of nico eggs against the total number of viable eggs
nico_egg_plot_log_both <- ggplot() +
  geom_point(data = egg_mortality_log_low, 
       aes(y = prop_viable_eggs, x = log_nico_eggs), color = low) + 
  geom_point(data = egg_mortality_log_high, 
       aes(y = prop_viable_eggs, x = log_nico_eggs), color = high) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Nico Eggs") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Nico Eggs") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 
  
#add the plots together
log_transformed_both <- ggarrange(adult_plot_log_both, juvenile_plot_log_both, total_plot_log_both, nico_egg_plot_log_both,
                           labels = c("a)", "b)", "c)", "d)"),
                           ncol = 2, nrow = 2)

#add a title for the figure 
annotate_figure(log_transformed_both,
               top = text_grob("Log-Transformed Data (Combined)", color = "black", face = "bold", size = 14))



```

## c) Squareroot Trasform the Counts 

#### i) All the Crabs

##### - logit transform the proportions
```{r}
#plot the number of adult nicos against the total number of viable eggs
adult_plot_sqrtit <- ggplot(data = egg_mortality_sqrt, 
       aes(y = log((prop_viable_eggs)/(1- prop_viable_eggs)), x = sqrt_adult_nicos)) +
  geom_point(data = egg_mortality_sqrt, 
             aes(color = color))  + 
  scale_color_manual(labels = c("J-L", "G-I", "D-F"),
                     values = c("darkgoldenrod1" = "darkgoldenrod1",
                               "coral2" = "coral2",
                               "brown4" = "brown4")) +  
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Adult Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        legend.position = "none")

#plot the number of juvenile nicos against the total number of viable eggs 
juvenile_plot_sqrtit <- ggplot(data = egg_mortality_sqrt, 
       aes(y = log((prop_viable_eggs)/(1- prop_viable_eggs)), x = sqrt_juvenile_nicos)) +
  geom_point(data = egg_mortality_sqrt, 
             aes(color = color))  + 
  scale_color_manual(labels = c("J-L", "G-I", "D-F"),
                     values = c("darkgoldenrod1" = "darkgoldenrod1",
                               "coral2" = "coral2",
                               "brown4" = "brown4")) +
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Larval Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Larval Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        legend.position = "none") 

#plot the number of total number of nicos against the total number of viable eggs
total_plot_sqrtit <- ggplot(data = egg_mortality_sqrt, 
       aes(y = log((prop_viable_eggs)/(1- prop_viable_eggs)), x = sqrt_total_nicos)) +
  geom_point(data = egg_mortality_sqrt, 
             aes(color = color))  + 
  scale_color_manual(labels = c("J-L", "G-I", "D-F"),
                     values = c("darkgoldenrod1" = "darkgoldenrod1",
                               "coral2" = "coral2",
                               "brown4" = "brown4")) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Total Number of Nicos (Larvae/Adults)") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Total Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        legend.position = "none")


#plot the number of nico eggs against the total number of viable eggs
nico_egg_plot_sqrtit <- ggplot(data = egg_mortality_sqrt, 
       aes(y = log((prop_viable_eggs)/(1- prop_viable_eggs)), x = sqrt_nico_eggs)) +
  geom_point(data = egg_mortality_sqrt, 
             aes(color = color))  + 
  scale_color_manual(labels = c("J-L", "G-I", "D-F"),
                     values = c("darkgoldenrod1" = "darkgoldenrod1",
                               "coral2" = "coral2",
                               "brown4" = "brown4")) +
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Nico Eggs") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Nico Eggs") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        legend.position = "none") 
  
#add the plots together
sqrt_transformed_logit <- ggarrange(adult_plot_sqrtit, juvenile_plot_sqrtit, total_plot_sqrtit, nico_egg_plot_sqrtit,
                           labels = c("a)", "b)", "c)", "d)"),
                           ncol = 2, nrow = 2, 
                           common.legend = TRUE, legend ="bottom")
#create a title 
sqrt_transformed_logit_title <- expression(atop(bold("Squareroot Transformed Counts:"), scriptstyle("Logit Transformed Proportions")))

#add a title for the figure 
annotate_figure(sqrt_transformed_logit,
               top = text_grob(sqrt_transformed_logit_title))


```



##### - arcsine transform the proportions
```{r}
#plot the number of adult nicos against the total number of viable eggs
adult_plot_sqrtasin <- ggplot(data = egg_mortality_sqrt, 
       aes(y = asin(sqrt(prop_viable_eggs)), x = sqrt_adult_nicos)) +
  geom_point(data = egg_mortality_sqrt, 
             aes(color = color))  + 
  scale_color_manual(labels = c("J-L", "G-I", "D-F"),
                     values = c("darkgoldenrod1" = "darkgoldenrod1",
                               "coral2" = "coral2",
                               "brown4" = "brown4")) +
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Adult Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        legend.position = "none")

#plot the number of juvenile nicos against the total number of viable eggs 
juvenile_plot_sqrtasin <- ggplot(data = egg_mortality_sqrt, 
       aes(y = asin(sqrt(prop_viable_eggs)), x = sqrt_juvenile_nicos)) +
  geom_point(data = egg_mortality_sqrt, 
             aes(color = color))  + 
  scale_color_manual(labels = c("J-L", "G-I", "D-F"),
                     values = c("darkgoldenrod1" = "darkgoldenrod1",
                               "coral2" = "coral2",
                               "brown4" = "brown4")) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Larval Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Larval Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        legend.position = "none") 

#plot the number of total number of nicos against the total number of viable eggs
total_plot_sqrtasin <- ggplot(data = egg_mortality_sqrt, 
       aes(y = asin(sqrt(prop_viable_eggs)), x = sqrt_total_nicos)) +
  geom_point(data = egg_mortality_sqrt, 
             aes(color = color))  + 
  scale_color_manual(labels = c("J-L", "G-I", "D-F"),
                     values = c("darkgoldenrod1" = "darkgoldenrod1",
                               "coral2" = "coral2",
                               "brown4" = "brown4")) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Total Number of Nicos (Larvae/Adults)") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Total Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        legend.position = "none")


#plot the number of nico eggs against the total number of viable eggs
nico_egg_plot_sqrtasin <- ggplot(data = egg_mortality_sqrt, 
       aes(y = asin(sqrt(prop_viable_eggs)), x = sqrt_nico_eggs)) +
  geom_point(data = egg_mortality_sqrt, 
             aes(color = color))  + 
  scale_color_manual(labels = c("J-L", "G-I", "D-F"),
                     values = c("darkgoldenrod1" = "darkgoldenrod1",
                               "coral2" = "coral2",
                               "brown4" = "brown4")) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Nico Eggs") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Nico Eggs") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8),
        legend.position = "none") 
  
#add the plots together
sqrt_transformed_asine <- ggarrange(adult_plot_sqrtasin, juvenile_plot_sqrtasin, total_plot_sqrtasin, nico_egg_plot_sqrtasin,
                           labels = c("a)", "b)", "c)", "d)"),
                           ncol = 2, nrow = 2, 
                           common.legend = TRUE, legend ="bottom")
#create a title 
sqrt_transformed_asine_title <- expression(atop(bold("Squareroot Transformed Counts:"), scriptstyle("Arcsine Transformed Proportions")))

#add a title for the figure 
annotate_figure(sqrt_transformed_asine,
               top = text_grob(sqrt_transformed_asine_title))


```




#### ii) Low Infestation 
```{r}
#plot the number of adult nicos against the total number of viable eggs 
adult_plot_sqrt_low <- ggplot() +
  geom_point(data = egg_mortality_sqrt_low, 
       aes(y = prop_viable_eggs, x = sqrt_adult_nicos), color = low) +
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Adult Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8))

#plot the number of juvenile nicos against the total number of viable eggs 
juvenile_plot_sqrt_low <- ggplot() +
  geom_point(data = egg_mortality_sqrt_low, 
       aes(y = prop_viable_eggs, x = sqrt_juvenile_nicos), color = low) +
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Larval Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Larval Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 

#plot the number of total number of nicos against the total number of viable eggs
total_plot_sqrt_low <- ggplot() +
  geom_point(data = egg_mortality_sqrt_low, 
       aes(y = prop_viable_eggs, x = sqrt_total_nicos), color = low) +
  geom_point(color = totals) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Total Number of Nicos (Larvae/Adults)") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Total Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8))


#plot the number of nico eggs against the total number of viable eggs
nico_egg_plot_sqrt_low <- ggplot() +
  geom_point(data = egg_mortality_sqrt_low, 
       aes(y = prop_viable_eggs, x = sqrt_nico_eggs), color = low) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Nico Eggs") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Nico Eggs") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 
  
#add the plots together
sqrt_transformed_low <- ggarrange(adult_plot_sqrt_low, juvenile_plot_sqrt_low, total_plot_sqrt_low, nico_egg_plot_sqrt_low,
                           labels = c("a)", "b)", "c)", "d)"),
                           ncol = 2, nrow = 2)

#add a title for the figure 
annotate_figure(sqrt_transformed_low,
               top = text_grob("Squareroot-Transformed Data (Low Infestation)", color = "black", face = "bold", size = 14))


```


#### iii) High Infestation
```{r}
#plot the number of adult nicos against the total number of viable eggs 
adult_plot_sqrt_high <- ggplot() +
  geom_point(data = egg_mortality_sqrt_high, 
       aes(y = prop_viable_eggs, x = sqrt_adult_nicos), color = high) +
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Adult Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8))

#plot the number of juvenile nicos against the total number of viable eggs 
juvenile_plot_sqrt_high <- ggplot() +
  geom_point(data = egg_mortality_sqrt_high, 
       aes(y = prop_viable_eggs, x = sqrt_juvenile_nicos), color = high) +
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Larval Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Larval Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 

#plot the number of total number of nicos against the total number of viable eggs
total_plot_sqrt_high <- ggplot() +
  geom_point(data = egg_mortality_sqrt_high, 
       aes(y = prop_viable_eggs, x = sqrt_total_nicos), color = high) +
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Total Number of Nicos (Larvae/Adults)") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Total Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8))


#plot the number of nico eggs against the total number of viable eggs
nico_egg_plot_sqrt_high <- ggplot() +
  geom_point(data = egg_mortality_sqrt_high, 
       aes(y = prop_viable_eggs, x = sqrt_nico_eggs), color = high) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Nico Eggs") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Nico Eggs") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 
  
#add the plots together
sqrt_transformed_high <- ggarrange(adult_plot_sqrt_high, juvenile_plot_sqrt_high, total_plot_sqrt_high, nico_egg_plot_sqrt_high,
                           labels = c("a)", "b)", "c)", "d)"),
                           ncol = 2, nrow = 2)

#add a title for the figure 
annotate_figure(sqrt_transformed_high,
               top = text_grob("Squareroot-Transformed Data (High Infestation)", color = "black", face = "bold", size = 14))

```





#### iv) Combined Plots 
```{r}
#plot the number of adult nicos against the total number of viable eggs 
adult_plot_sqrt_both <- ggplot() +
  geom_point(data = egg_mortality_sqrt_low, 
       aes(y = asin(prop_viable_eggs), x = sqrt_adult_nicos), color = low) + 
  geom_point(data = egg_mortality_sqrt_high, 
       aes(y = asin(prop_viable_eggs), x = sqrt_adult_nicos), color = high) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Adult Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8))

#plot the number of juvenile nicos against the total number of viable eggs 
juvenile_plot_sqrt_both <- ggplot() +
  geom_point(data = egg_mortality_sqrt_low, 
       aes(y = asin(prop_viable_eggs), x = sqrt_juvenile_nicos), color = low) + 
  geom_point(data = egg_mortality_sqrt_high, 
       aes(y = asin(prop_viable_eggs), x = sqrt_juvenile_nicos), color = high) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Larval Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Larval Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 

#plot the number of total number of nicos against the total number of viable eggs
total_plot_sqrt_both <- ggplot() +
  geom_point(data = egg_mortality_sqrt_low, 
       aes(y = asin(prop_viable_eggs), x = sqrt_total_nicos), color = low) +
  geom_point(data = egg_mortality_sqrt_high, 
       aes(y = asin(prop_viable_eggs), x = sqrt_total_nicos), color = high) +
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Total Number of Nicos (Larvae/Adults)") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Total Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8))


#plot the number of nico eggs against the total number of viable eggs
nico_egg_plot_sqrt_both <- ggplot() +
  geom_point(data = egg_mortality_sqrt_low, 
       aes(y = asin(prop_viable_eggs), x = sqrt_nico_eggs), color = low) + 
  geom_point(data = egg_mortality_sqrt_high, 
       aes(y = asin(prop_viable_eggs), x = sqrt_nico_eggs), color = high) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Nico Eggs") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Nico Eggs") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 
  
#add the plots together
sqrt_transformed_both <- ggarrange(adult_plot_sqrt_both, juvenile_plot_sqrt_both, total_plot_sqrt_both, nico_egg_plot_sqrt_both,
                           labels = c("a)", "b)", "c)", "d)"),
                           ncol = 2, nrow = 2)

#add a title for the figure 
annotate_figure(sqrt_transformed_both,
               top = text_grob("Squareroot-Transformed Data (Combined)", color = "black", face = "bold", size = 14))


```



## d) Arcsine Transform the Proportions


### i) All the crabs
```{r}
#scale up the data then arcsine transform the data
egg_mortality_arcsine <- egg_mortality %>%
  mutate(scale_prop_viable_eggs = prop_viable_eggs*1000) %>%
  mutate(arcsine_prop_viable_eggs = asin((prop_viable_eggs))) %>%
  mutate(arcsine_adult_nicos = (sqrt(number_adult_nicos))) %>%
  mutate(arcsine_juvenile_nicos = (sqrt(number_juvenile_nicos))) %>%
  mutate(arcsine_total_nicos = (sqrt(total_nicos))) %>%
  mutate(arcsine_nico_eggs = (sqrt(number_nico_eggs))) 


#plot the number of adult nicos against the total number of viable eggs
adult_plot_arcsine <- ggplot(data = egg_mortality_arcsine, 
       aes(y = prop_viable_eggs, x = arcsine_adult_nicos)) +
  geom_point(color = adults) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Adult Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8))

#plot the number of juvenile nicos against the total number of viable eggs 
juvenile_plot_arcsine <- ggplot(data = egg_mortality_arcsine, 
       aes(y = prop_viable_eggs, x = arcsine_juvenile_nicos)) +
  geom_point(color = juveniles) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Larval Nicos") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Larval Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 

#plot the number of total number of nicos against the total number of viable eggs
total_plot_arcsine <- ggplot(data = egg_mortality_arcsine, 
       aes(y = prop_viable_eggs, x = arcsine_total_nicos)) +
  geom_point(color = totals) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Total Number of Nicos (Larvae/Adults)") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Total Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8))


#plot the number of nico eggs against the total number of viable eggs
nico_egg_plot_arcsine <- ggplot(data = egg_mortality_arcsine, 
       aes(y = prop_viable_eggs, x = arcsine_nico_eggs)) +
  geom_point(color = nico_eggs) + 
  #geom_smooth(method = lm, level = 0.95, color = "black") +
  theme_gray() +
  xlab("Number of Nico Eggs") +
  ylab("Proportion of Viable Crab Eggs") + 
  ggtitle("Nico Eggs") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 6),
        axis.title.x = element_text(size = 8)) 
  
#add the plots together
arcsine_transformed <- ggarrange(adult_plot_arcsine, juvenile_plot_arcsine, total_plot_arcsine, nico_egg_plot_arcsine,
                           labels = c("a)", "b)", "c)", "d)"),
                           ncol = 2, nrow = 2)
#add a title for the figure 
annotate_figure(arcsine_transformed,
               top = text_grob("Arcsine-Transformed Data", color = "black", face = "bold", size = 14))



```




## e) Logit Transform the Proportions


# 4. Frequency Distribution

### a) Distribution from Egg Mortality Data

#### i) Adults
```{r}
#use Freedman Diaconis rule to determine optimal binwidth:
bw_eggs_adults_crab_id <-2 *IQR(crab_id$adults_scaled)/length(crab_id$adults_scaled)^(1/3)

#create a histogram of the distribution of adults (averages per sample)
freqdist_eggs_adults_crab_id <- gghistogram(data = crab_id, 
                              x = "adults_scaled", 
                              fill = adults,
                              binwidth = bw_eggs_adults_crab_id)+
  ylab("Frequency of Crabs") +
  xlab("Average Count of Adult Nicothoids per One Million Crab Eggs") + 
  #ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_y_continuous(expand =c(0,0)) +
  #geom_vline(aes(xintercept = 20),color = "red", linewidth = 1)+
  theme_classic()

freqdist_eggs_adults_crab_id

#create a histogram of the distribution of adults (averaged per totals)
freqdist_eggs_adults <- gghistogram(data = totals_per_crab_id, 
                              x = "adults_scaled", 
                              fill = adults,
                              binwidth = bw_eggs_adults)+
  ylab("Frequency of Crabs") +
  xlab("Average Count of Adult Nicothoids per One Million Crab Eggs") + 
  #ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_y_continuous(expand =c(0,0)) +
  #geom_vline(aes(xintercept = 20),color = "red", linewidth = 1)+
  theme_classic()

freqdist_eggs_adults

```


#### ii) Juveniles
```{r}
#use Freedman Diaconis rule to determine optimal binwidth:
bw_eggs_juveniles <-2 *IQR(totals_per_crab_id$juveniles_scaled)/length(totals_per_crab_id$juveniles_scaled)^(1/3)

#create a histogram of the distribution of adults
freqdist_eggs_juveniles <- gghistogram(data = totals_per_crab_id, 
                              x = "juveniles_scaled", 
                              fill = juveniles,
                              binwidth = bw_eggs_juveniles)+
  ylab("Frequency of Crabs") +
  xlab("Average Count of Larval Nicothoids per One Million Crab Eggs") + 
  #ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_y_continuous(expand =c(0,0)) +
  #geom_vline(aes(xintercept = 20),color = "red", linewidth = 1)+
  theme_classic()

freqdist_eggs_juveniles

```



#### iii) Total Nicos 
```{r}
#use Freedman Diaconis rule to determine optimal binwidth:
bw_eggs_total_nicos <-2 *IQR(totals_per_crab_id$total_nicos_scaled)/length(totals_per_crab_id$total_nicos_scaled)^(1/3)

#create a histogram of the distribution of adults
freqdist_eggs_total_nicos <- gghistogram(data = totals_per_crab_id, 
                              x = "total_nicos_scaled", 
                              fill = totals,
                              binwidth = bw_eggs_total_nicos)+
  ylab("Frequency of Crabs") +
  xlab("Average Count of Total Nicothoids per One Million Crab Eggs") + 
  #ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_y_continuous(expand =c(0,0)) +
  #geom_vline(aes(xintercept = 20),color = "red", linewidth = 1)+
  theme_classic()

freqdist_eggs_total_nicos

```




#### iv) Nico Eggs
```{r}
#use Freedman Diaconis rule to determine optimal binwidth:
bw_eggs_nico_eggs <-2 *IQR(totals_per_crab_id$nico_eggs_scaled)/length(totals_per_crab_id$nico_eggs_scaled)^(1/3)

#create a histogram of the distribution of adults
freqdist_eggs_nico_eggs <- gghistogram(data = totals_per_crab_id, 
                              x = "nico_eggs_scaled", 
                              fill = nico_eggs,
                              binwidth = bw_eggs_nico_eggs)+
  ylab("Frequency of Crabs") +
  xlab("Average Count of Nico Eggs per One Million Crab Eggs") + 
  #ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_y_continuous(expand =c(0,0)) +
  #geom_vline(aes(xintercept = 20),color = "red", linewidth = 1)+
  theme_classic()

freqdist_eggs_nico_eggs

```



### b) Histogram for Adults

#### i) Old Autoinfection Data
```{r a nice freq dist histogram}
#plot the frequency of adult nicos 
## need to use data grouped by crab_id to accurately understand distribution among crabs
## made a new df above (1c)

#use Freedman Diaconis rule to determine optimal binwidth:
bw_old <-2 *IQR(adult_summary$nicos_extrapolated_1mil)/length(adult_summary$nicos_extrapolated_1mil)^(1/3)

freqdist_adults_old <- gghistogram(data = adult_summary, 
                              x = "nicos_extrapolated_1mil", 
                              fill = "#D7301F",
                              binwidth = bw_old)+
  ylab("Frequency of Crabs") +
  xlab("Average Count of Adult Nicothoids per One Million Crab Eggs") + 
  #ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5))+
  scale_y_continuous(expand =c(0,0))+
  #geom_vline(aes(xintercept = 20),color = "red", linewidth = 1)+
  theme_classic()

ggsave("adult_nico_freq_distribution.png", freqdist_adults_old, device = "png")

freqdist_adults_old

```

#### ii) New Autoinfection Data
```{r a nice freq dist histogram}
#use Freedman Diaconis rule to determine optimal binwidth:
bw_new <-2 *IQR(adult_summary_new$nicos_extrapolated_1mil)/length(adult_summary_new$nicos_extrapolated_1mil)^(1/3)

#create a histogram of the frequency distribution of the all the adult nicos found in a crab
freqdist_adults_new <- gghistogram(data = adult_summary_new, 
                              x = "nicos_extrapolated_1mil", 
                              fill = "#D7301F",
                              binwidth = bw_new)+
  ylab("Frequency of Crabs") +
  xlab("Average Count of Adult Nicothoids per One Million Crab Eggs") + 
  #ggtitle("Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5))+
  scale_y_continuous(expand =c(0,0))+
  #geom_vline(aes(xintercept = 20),color = "red", linewidth = 1)+
  theme_classic()

#save the output as as png
ggsave("adult_nico_freq_distribution_new.png", freqdist_adults_new, device = "png")

freqdist_adults_new

```


# 5. Analysis (Egg Mass)

### a) Generalized Linear Models EDS (ignore)
```{r}
#create a generalized linear model to evaluate the relationship between viable eggs and number of adult nicos

##poisson 
glm.adults.poisson <- glmer(prop_viable_eggs ~ prop_adults_alone + (1|crab_id), 
                   data = timeseries, 
                   family = "poisson")

##negative binomial 
#glm.adults.nb <- glmer.nb(number_viable_crab_eggs ~ number_adult_nicos + (1|crab_id), 
                   #data = egg_mortality)

#create a generalized linear model to evaluate the relationship between viable eggs and number of juvenile nicos

##poisson 
glm.juveniles.poisson <- glmer(prop_viable_eggs ~ prop_juveniles_alone + (1|crab_id), 
                   data = timeseries, 
                   family = "poisson")

##negative binomial 
glm.juveniles.nb <- glmer.nb(prop_viable_eggs ~ prop_juveniles_alone + (1|crab_id), 
                   data = timeseries)
 

#create a generalized linear model to evaluate the relationship between viable eggs and number of nicos eggs

##poisson 
glm.nicoeggs.poisson <- glmer(prop_viable_eggs ~ prop_nico_eggs_alone + (1|crab_id), 
                   data = timeseries, 
                   family = "poisson")

##negative binomial 
glm.nicoeggs.nb <- glmer.nb(prop_viable_eggs ~ prop_nico_eggs_alone + (1|crab_id), 
                   data = timeseries)

#evaluate with interactions of all of the states

##poisson 
#glm.combined.poisson <- glmer(number_viable_crab_eggs ~ number_adult_nicos*number_juvenile_nicos*number_nico_eggs + (1|crab_id), 
                   #data = egg_mortality, 
                   #family = "poisson")

##negative binomial 
#glm.combined.nb <- glmer.nb(number_viable_crab_eggs ~ number_adult_nicos*number_juvenile_nicos*number_nico_eggs + (1|crab_id), 
                   #data = egg_mortality)

```


### b) Generalized Linear Models Development Day (ignore)
```{r}
#subset the data to be modeled with 
model <- timeseries %>%
  select(c(2,4,8,12:14,17,19,24))

#start playing with some model combinations
glm.adults.poisson_prop <- glmer(prop_viable_eggs ~ prop_total_nicos_alone*eds + (1|crab_id), 
                   data = model, 
                   family = "poisson")

summary(glm.adults.poisson_prop)

glm.adults.poisson <- glmer(number_viable_crab_eggs ~ total_nicos*eds + (1|crab_id), 
                   data = model, 
                   family = "poisson")

summary(glm.adults.poisson)


```




# 6) Mean Density (all crabs)

### a) Throughout all Development Days

#### i) Mean Density (all life stages)
```{r}
#create a data frame with the scaled density of the adults in the egg mass per 1000 eggs
egg_mortality_density <- egg_mortality %>%
  mutate(density_adult_nicos = ((number_adult_nicos/total_number_crab_eggs)*1000)) %>%
  mutate(density_juvenile_nicos = ((number_juvenile_nicos/total_number_crab_eggs)*1000)) %>%
  mutate(density_total_nicos = ((total_nicos/total_number_crab_eggs)*1000)) %>%
  mutate(density_nico_eggs = ((number_nico_eggs/total_number_crab_eggs)*1000))

#calculate the mean density and standard deviation of each of the values 

##calculate mean adult density 
mean_adult_density <- mean(egg_mortality_density$density_adult_nicos)
mean_adult_density

##calculate standard deviation of mean adult density
mean_adult_density_sd <- sd(egg_mortality_density$density_adult_nicos)
mean_adult_density_sd



##calculate mean juvenile density 
mean_juvenile_density <- mean(egg_mortality_density$density_juvenile_nicos)
mean_juvenile_density

##calculate standard deviation of mean juvenile density
mean_juvenile_density_sd <- sd(egg_mortality_density$density_juvenile_nicos)
mean_juvenile_density_sd



##calculate mean total density 
mean_total_density <- mean(egg_mortality_density$density_total_nicos)
mean_total_density

##calculate standard deviation of mean total nico density
mean_total_density_sd <- sd(egg_mortality_density$density_total_nicos)
mean_total_density_sd



##calculate mean nico egg density 
mean_nico_egg_density <- mean(egg_mortality_density$density_nico_eggs)
mean_nico_egg_density

##calculate standard deviation of mean nico egg density
mean_nico_egg_density_sd <- sd(egg_mortality_density$density_nico_eggs)
mean_nico_egg_density_sd

```
#### ii) Mean Density (adults with all datasets)
```{r}
#create a column in the autoinfection data with the density of adult nicos
autoinfection_density <- autoinfection %>%
  mutate(density_adult_nicos = ((number_of_adult_copepods/total_number_of_eggs)*1000)) %>%
  select(1,9,13) %>%
  rename(number_adult_nicos = number_of_adult_copepods)

#subset the egg morality data for just the adults and the adult density
mort_egg_density <- egg_mortality_density %>%
  select(1,11,19)

#join the two dataframes for the adult density
mort_egg_density_combined <- rbind(mort_egg_density, autoinfection_density)

#calculate the mean density of the adults
mean_adult_density_all <- mean(mort_egg_density_combined$density_adult_nicos)
mean_adult_density_all

#calculate standard deviation of mean adult density of all the adults 
mean_adult_density_all_sd <- sd(mort_egg_density_combined$density_adult_nicos)
mean_adult_density_all_sd

```


#### iii) Mean Intensity (ignore)
```{r}
#calculate the mean intensity of each of the values 
mean_adult_intensity <- mean(egg_mortality$number_adult_nicos)
mean_adult_intensity
# we need to eventually find a way to scale this up to the whole crab ΟTHERWISE ITS NOT INTENSITY - 700 thousand to 3.3 millon eggs 

mean_juvenile_intensity <- mean(egg_mortality$number_juvenile_nicos)
mean_juvenile_intensity

mean_total_intensity <- mean(egg_mortality$total_nicos)
mean_total_intensity

mean_nico_egg_intensity <- mean(egg_mortality$number_nico_eggs)
mean_nico_egg_intensity
```

#### v) Mean Egg Mortality
```{r}
#look at the summary stats
summary_egg_mortality <- summary(egg_mortality$prop_nonviable_eggs)
summary_egg_mortality

#calculate the min egg mortality as a percent
min_egg_mortality <- min((egg_mortality$prop_nonviable_eggs)*100)
min_egg_mortality

#calculate the mean egg mortality as a percent
mean_egg_mortality <- mean((egg_mortality$prop_nonviable_eggs)*100)
mean_egg_mortality

#calculate the max egg morality as a percent
max_egg_mortality <- max((egg_mortality$prop_nonviable_eggs)*100)
max_egg_mortality

```

### b) Late Development Days 

#### i) Mean Density (all life stages)
```{r}
#create a dataframe with only development days greater than 40 days
late_eds <- egg_mortality_day %>%
  mutate(total_nicos = (number_adult_nicos + number_juvenile_nicos)) %>%
  mutate(density_adult_nicos = ((number_adult_nicos/total_number_crab_eggs)*1000)) %>%
  mutate(density_juvenile_nicos = ((number_juvenile_nicos/total_number_crab_eggs)*1000)) %>%
  mutate(density_total_nicos = ((total_nicos/total_number_crab_eggs)*1000)) %>%
  mutate(density_nico_eggs = ((number_nico_eggs/total_number_crab_eggs)*1000)) %>%
  filter(day >= 40)

#calculate the mean density and standard deviation of each of the values 

##calculate mean adult density 
mean_adult_density_late <- mean(late_eds$density_adult_nicos)
mean_adult_density_late

##calculate standard deviation of mean adult density
mean_adult_density_sd_late <- sd(late_eds$density_adult_nicos)
mean_adult_density_sd_late



##calculate mean juvenile density 
mean_juvenile_density_late <- mean(late_eds$density_juvenile_nicos)
mean_juvenile_density_late

##calculate standard deviation of mean juvenile density
mean_juvenile_density_sd_late <- sd(late_eds$density_juvenile_nicos)
mean_juvenile_density_sd_late



##calculate mean total density 
mean_total_density_late <- mean(late_eds$density_total_nicos)
mean_total_density_late

##calculate standard deviation of mean total nico density
mean_total_density_sd_late <- sd(late_eds$density_total_nicos)
mean_total_density_sd_late



##calculate mean nico egg density 
mean_nico_egg_density_late <- mean(late_eds$density_nico_eggs)
mean_nico_egg_density_late

##calculate standard deviation of mean nico egg density
mean_nico_egg_density_sd_late <- sd(late_eds$density_nico_eggs)
mean_nico_egg_density_sd_late

```


#### ii) Mean Egg Mortality
```{r}
#look at the summary stats
summary_egg_mortality_late <- summary(late_eds$prop_nonviable_eggs)
summary_egg_mortality_late

#calculate the min egg mortality as a percent
min_egg_mortality_late <- min((late_eds$prop_nonviable_eggs)*100)
min_egg_mortality_late

#calculate the mean egg mortality as a percent
mean_egg_mortality_late <- mean((late_eds$prop_nonviable_eggs)*100)
mean_egg_mortality_late

#calculate the max egg morality as a percent
max_egg_mortality_late <- max((late_eds$prop_nonviable_eggs)*100)
max_egg_mortality_late

```

# 7) Mean Density (low infestation crabs)

### a) Throughout all Development Days

#### i) Mean Density (all life stages)
```{r}
#create a dataframe for the low infestation crabs 
egg_mortality_density_low <- egg_mortality_density %>%
  filter(!crab_id %in% c("ANT-GAV-034", "ANT-GAV-037", "ANT-GAV-045", "ANT-GAV-053"))


#calculate the mean density and standard deviation of each of the values for the low infestation crabs (all the crabs expect ANT-GAV-034, ANT-GAV-037, ANT-GAV-045, and ANT-GAV-053)

##calculate mean adult density 
mean_adult_density_low <- mean(egg_mortality_density_low$density_adult_nicos)
mean_adult_density_low

##calculate standard deviation of mean adult density
mean_adult_density_sd_low <- sd(egg_mortality_density_low$density_adult_nicos)
mean_adult_density_sd_low



##calculate mean juvenile density 
mean_juvenile_density_low <- mean(egg_mortality_density_low$density_juvenile_nicos)
mean_juvenile_density_low

##calculate standard deviation of mean juvenile density
mean_juvenile_density_sd_low <- sd(egg_mortality_density_low$density_juvenile_nicos)
mean_juvenile_density_sd_low



##calculate mean total density 
mean_total_density_low <- mean(egg_mortality_density_low$density_total_nicos)
mean_total_density_low

##calculate standard deviation of mean total nico density
mean_total_density_sd_low <- sd(egg_mortality_density_low$density_total_nicos)
mean_total_density_sd_low



##calculate mean nico egg density 
mean_nico_egg_density_low <- mean(egg_mortality_density_low$density_nico_eggs)
mean_nico_egg_density_low

##calculate standard deviation of mean nico egg density
mean_nico_egg_density_sd_low <- sd(egg_mortality_density_low$density_nico_eggs)
mean_nico_egg_density_sd_low

```


#### ii) Mean Egg Mortality
```{r}
#look at the summary stats for low infestation crabs
summary_egg_mortality_low <- summary(egg_mortality_density_low$prop_nonviable_eggs)
summary_egg_mortality_low

#calculate the min egg mortality as a percent
min_egg_mortality_low <- min((egg_mortality_density_low$prop_nonviable_eggs)*100)
min_egg_mortality_low

#calculate the mean egg mortality as a percent
mean_egg_mortality_low <- mean((egg_mortality_density_low$prop_nonviable_eggs)*100)
mean_egg_mortality_low

#calculate the max egg morality as a percent
max_egg_mortality_low <- max((egg_mortality_density_low$prop_nonviable_eggs)*100)
max_egg_mortality_low

```

### b) Late Development Days

#### i) Mean Density (all life stages)
```{r}
#create a dataframe with only development days greater than 40 days for the low infestation crabs
late_eds_low <- egg_mortality_day %>%
  mutate(total_nicos = (number_adult_nicos + number_juvenile_nicos)) %>%
  mutate(density_adult_nicos = ((number_adult_nicos/total_number_crab_eggs)*1000)) %>%
  mutate(density_juvenile_nicos = ((number_juvenile_nicos/total_number_crab_eggs)*1000)) %>%
  mutate(density_total_nicos = ((total_nicos/total_number_crab_eggs)*1000)) %>%
  mutate(density_nico_eggs = ((number_nico_eggs/total_number_crab_eggs)*1000)) %>%
  filter(day >= 40) %>%
  filter(!crab_id %in% c("ANT-GAV-034", "ANT-GAV-037", "ANT-GAV-045", "ANT-GAV-053"))
  

#calculate the mean density and standard deviation of each of the values 

##calculate mean adult density 
mean_adult_density_late_low <- mean(late_eds_low$density_adult_nicos)
mean_adult_density_late_low

##calculate standard deviation of mean adult density
mean_adult_density_sd_late_low <- sd(late_eds_low$density_adult_nicos)
mean_adult_density_sd_late_low



##calculate mean juvenile density 
mean_juvenile_density_late_low <- mean(late_eds_low$density_juvenile_nicos)
mean_juvenile_density_late_low

##calculate standard deviation of mean juvenile density
mean_juvenile_density_sd_late_low <- sd(late_eds_low$density_juvenile_nicos)
mean_juvenile_density_sd_late_low



##calculate mean total density 
mean_total_density_late_low <- mean(late_eds_low$density_total_nicos)
mean_total_density_late_low

##calculate standard deviation of mean total nico density
mean_total_density_sd_late_low <- sd(late_eds_low$density_total_nicos)
mean_total_density_sd_late_low



##calculate mean nico egg density 
mean_nico_egg_density_late_low <- mean(late_eds_low$density_nico_eggs)
mean_nico_egg_density_late_low

##calculate standard deviation of mean nico egg density
mean_nico_egg_density_sd_late_low <- sd(late_eds_low$density_nico_eggs)
mean_nico_egg_density_sd_late_low

```


#### ii) Mean Egg Mortality
```{r}
#look at the summary stats for low infestation crabs
summary_egg_mortality_low_late <- summary(late_eds_low$prop_nonviable_eggs)
summary_egg_mortality_low_late

#calculate the min egg mortality as a percent
min_egg_mortality_low_late <- min((late_eds_low$prop_nonviable_eggs)*100)
min_egg_mortality_low_late

#calculate the mean egg mortality as a percent
mean_egg_mortality_low_late <- mean((late_eds_low$prop_nonviable_eggs)*100)
mean_egg_mortality_low_late

#calculate the max egg morality as a percent
max_egg_mortality_low_late <- max((late_eds_low$prop_nonviable_eggs)*100)
max_egg_mortality_low_late

```


# 8) Mean Density (high infestation crabs)

### a) Throughout all Development Days

#### i) Mean Density (all life stages)
```{r}
#create a dataframe for the high infestation crabs 
egg_mortality_density_high <- egg_mortality_density %>%
  mutate(density_adult_nicos = ((number_adult_nicos/total_number_crab_eggs)*1000)) %>%
  mutate(density_juvenile_nicos = ((number_juvenile_nicos/total_number_crab_eggs)*1000)) %>%
  mutate(density_total_nicos = ((total_nicos/total_number_crab_eggs)*1000)) %>%
  mutate(density_nico_eggs = ((number_nico_eggs/total_number_crab_eggs)*1000)) %>%
  filter(crab_id %in% c("ANT-GAV-034", "ANT-GAV-037", "ANT-GAV-045", "ANT-GAV-053"))

#calculate the mean density and standard deviation of each of the values for the high infestation crabs (ANT-GAV-034, ANT-GAV-037, ANT-GAV-045, and ANT-GAV-053)

##calculate mean adult density 
mean_adult_density_high <- mean(egg_mortality_density_high$density_adult_nicos)
mean_adult_density_high

##calculate standard deviation of mean adult density
mean_adult_density_sd_high <- sd(egg_mortality_density_high$density_adult_nicos)
mean_adult_density_sd_high



##calculate mean juvenile density 
mean_juvenile_density_high <- mean(egg_mortality_density_high$density_juvenile_nicos)
mean_juvenile_density_high

##calculate standard deviation of mean juvenile density
mean_juvenile_density_sd_high <- sd(egg_mortality_density_high$density_juvenile_nicos)
mean_juvenile_density_sd_high



##calculate mean total density 
mean_total_density_high <- mean(egg_mortality_density_high$density_total_nicos)
mean_total_density_high

##calculate standard deviation of mean total nico density
mean_total_density_sd_high <- sd(egg_mortality_density_high$density_total_nicos)
mean_total_density_sd_high



##calculate mean nico egg density 
mean_nico_egg_density_high <- mean(egg_mortality_density_high$density_nico_eggs)
mean_nico_egg_density_high

##calculate standard deviation of mean nico egg density
mean_nico_egg_density_sd_high <- sd(egg_mortality_density_high$density_nico_eggs)
mean_nico_egg_density_sd_high

```


#### ii) Mean Egg Mortality
```{r}
#look at the summary stats for low infestation crabs
summary_egg_mortality_high <- summary(egg_mortality_density_high$prop_nonviable_eggs)
summary_egg_mortality_high

#calculate the min egg mortality as a percent
min_egg_mortality_high <- min((egg_mortality_density_high$prop_nonviable_eggs)*100)
min_egg_mortality_high

#calculate the mean egg mortality as a percent
mean_egg_mortality_high <- mean((egg_mortality_density_high$prop_nonviable_eggs)*100)
mean_egg_mortality_high

#calculate the max egg morality as a percent
max_egg_mortality_high <- max((egg_mortality_density_high$prop_nonviable_eggs)*100)
max_egg_mortality_high

```

### b) Late Development Days

#### i) Mean Density (all life stages)
```{r}
#create a dataframe with only development days greater than 40 days for the low infestation crabs
late_eds_high <- egg_mortality_day %>%
  mutate(total_nicos = (number_adult_nicos + number_juvenile_nicos)) %>%
  mutate(density_adult_nicos = ((number_adult_nicos/total_number_crab_eggs)*1000)) %>%
  mutate(density_juvenile_nicos = ((number_juvenile_nicos/total_number_crab_eggs)*1000)) %>%
  mutate(density_total_nicos = ((total_nicos/total_number_crab_eggs)*1000)) %>%
  mutate(density_nico_eggs = ((number_nico_eggs/total_number_crab_eggs)*1000)) %>%
  filter(day >= 40) %>%
  filter(crab_id %in% c("ANT-GAV-034", "ANT-GAV-037", "ANT-GAV-045", "ANT-GAV-053"))
  

#calculate the mean density and standard deviation of each of the values 

##calculate mean adult density 
mean_adult_density_late_high <- mean(late_eds_high$density_adult_nicos)
mean_adult_density_late_high

##calculate standard deviation of mean adult density
mean_adult_density_sd_late_high <- sd(late_eds_high$density_adult_nicos)
mean_adult_density_sd_late_high



##calculate mean juvenile density 
mean_juvenile_density_late_high <- mean(late_eds_high$density_juvenile_nicos)
mean_juvenile_density_late_high

##calculate standard deviation of mean juvenile density
mean_juvenile_density_sd_late_high <- sd(late_eds_high$density_juvenile_nicos)
mean_juvenile_density_sd_late_high



##calculate mean total density 
mean_total_density_late_high <- mean(late_eds_high$density_total_nicos)
mean_total_density_late_high

##calculate standard deviation of mean total nico density
mean_total_density_sd_late_high <- sd(late_eds_high$density_total_nicos)
mean_total_density_sd_late_high



##calculate mean nico egg density 
mean_nico_egg_density_late_high <- mean(late_eds_high$density_nico_eggs)
mean_nico_egg_density_late_high

##calculate standard deviation of mean nico egg density
mean_nico_egg_density_sd_late_high <- sd(late_eds_high$density_nico_eggs)
mean_nico_egg_density_sd_late_high

```

#### ii) Mean Egg Mortality
```{r}
#look at the summary stats for high infestation crabs
summary_egg_mortality_high_late <- summary(late_eds_high$prop_nonviable_eggs)
summary_egg_mortality_high_late

#calculate the min egg mortality as a percent
min_egg_mortality_high_late <- min((late_eds_high$prop_nonviable_eggs)*100)
min_egg_mortality_high_late

#calculate the mean egg mortality as a percent
mean_egg_mortality_high_late <- mean((late_eds_high$prop_nonviable_eggs)*100)
mean_egg_mortality_high_late

#calculate the max egg morality as a percent
max_egg_mortality_high_late <- max((late_eds_high$prop_nonviable_eggs)*100)
max_egg_mortality_high_late

```



# 9. Analysis (Gills)

### a) Mean Density 

#### i) All Species/All Sexes
```{r}
##sample size n = 37

#calculate the average number of lamellae in a gill
average_lamellae_count <- mean(dissections$number_lamellae)
average_lamellae_count


#create a data frame with the density of juvenile nicos per lamellae and add in this density scaled to all gills
gill_density <- dissections %>%
  mutate(nico_per_lamellae = (nicothoid_count/number_lamellae)) %>%
  mutate(nico_per_gill = nico_per_lamellae*average_lamellae_count) %>%
  mutate(total_nicos_gill = nico_per_gill*12)
  

#remove the two males that were held too long before being dissected (MANT-GAV-003 and MANT-GAV-005)
clean_dissections <- gill_density %>%
  filter(!dissection_id %in% c("Dissection-027", "Dissection-028"))

##sample size n = 35

#calculate the mean density of the nicos in the gills
mean_density_gills <- mean(clean_dissections$total_nicos_gill)
mean_density_gills

#calculate standard deviation of mean density of the adults in the gills
mean_density_gills_sd <- sd(clean_dissections$total_nicos_gill)
mean_density_gills_sd

```


#### ii) All Sexes Yellow Crabs
```{r}
#subset for yellows only

##sample size n = 21
yellow_all <- clean_dissections %>%
  filter(species == "yellow") 

#calculate the mean density of the nicos in the gills of both male and female yellows
yellow_all_mean_density <- mean(yellow_all$total_nicos_gill)
yellow_all_mean_density

#calculate standard deviation of the mean density
yellow_all_mean_density_gills_sd <- sd(yellow_all$total_nicos_gill)
yellow_all_mean_density_gills_sd

```



#### iii) All Sexes Red Crabs 
```{r}
#subset for reds only

##sample size n = 2
red_all <- clean_dissections %>%
  filter(species == "red") 

#calculate the mean density of the nicos in the gills of both male and female reds
red_all_mean_density <- mean(red_all$total_nicos_gill)
red_all_mean_density

#calculate standard deviation of the mean density
red_all_mean_density_gills_sd <- sd(red_all$total_nicos_gill)
red_all_mean_density_gills_sd

```


#### iv) All Sexes Brown Crabs
```{r}
#subset for browns only

##sample size n = 1
brown_all <- clean_dissections %>%
  filter(species == "brown") 

#calculate the mean density of the nicos in the gills of both male and female browns
brown_all_mean_density <- mean(brown_all$total_nicos_gill)
brown_all_mean_density

#calculate standard deviation of the mean density
brown_all_mean_density_gills_sd <- sd(brown_all$total_nicos_gill)
brown_all_mean_density_gills_sd

```


#### v) All Species Males
```{r}
#subset for all males

##sample size n = 7
males_all <- clean_dissections %>%
  filter(sex == "male") 

#calculate the mean density of the nicos in the gills of males of all species
males_all_mean_density <- mean(males_all$total_nicos_gill)
males_all_mean_density

#calculate standard deviation of the mean density
males_all_mean_density_gills_sd <- sd(males_all$total_nicos_gill)
males_all_mean_density_gills_sd

```


#### vi) All Species Females
```{r}
#subset for all females

##sample size n = 20
females_all <- clean_dissections %>%
  filter(sex == "female") 

#calculate the mean density of the nicos in the gills of females of all species
females_all_mean_density <- mean(females_all$total_nicos_gill)
females_all_mean_density

#calculate standard deviation of the mean density
females_all_mean_density_gills_sd <- sd(females_all$total_nicos_gill)
females_all_mean_density_gills_sd

```


### b) Mean Intensity (ignore)
```{r}
#divide the nicos/lamallae*the number of gills (12 gills per crab)
#gill_intensity <- clean_dissections %>%
  #mutate(intensity_nicos_gills = (density_nicos_gills*12))

#calculate the mean intensity for the nicos in the gills 
#mean_intensity_gills <- mean(gill_intensity$intensity_nicos_gills)
#mean_intensity_gills

```


### c) Mean Density 

#### i) Yellow Males
```{r}
#subset for yellow males only
##I chose to exclude two males (MANT-GAV-003 and MANT-GAV-005) we dissected because they had been held for over a month before dissection and I believe that this is why they didn't have nicos -- we are planning to do a few more male dissections

##sample size n = 6
yellow_males <- yellow_all %>%
  filter(sex == "male") 

#calculate the mean density of the nicos in the gills of yellow males
yellow_males_mean_density <- mean(yellow_males$total_nicos_gill)
yellow_males_mean_density

#calculate standard deviation of the mean density
yellow_males_mean_density_gills_sd <- sd(yellow_males$total_nicos_gill)
yellow_males_mean_density_gills_sd

```

#### ii) Red Males
```{r}
#subset for red males only

##sample size n = 1
red_males <- red_all %>%
  filter(sex == "male") 

#calculate the mean density of the nicos in the gills of red males
red_males_mean_density <- mean(red_males$total_nicos_gill)
red_males_mean_density

#calculate standard deviation of the mean density
red_males_mean_density_gills_sd <- sd(red_males$total_nicos_gill)
red_males_mean_density_gills_sd

```

#### iii) Brown Males
```{r}
#subset for brown males only

##sample size n = 1
brown_males <- brown_all %>%
  filter(sex == "male") 

#calculate the mean density of the nicos in the gills of red males
brown_males_mean_density <- mean(brown_males$total_nicos_gill)
brown_males_mean_density

#calculate standard deviation of the mean density
brown_males_mean_density_gills_sd <- sd(brown_males$total_nicos_gill)
brown_males_mean_density_gills_sd

```


### d) Mean Density 

#### i) Yellow Females
```{r}
#subset for yellow females only

##sample size n = 16
yellow_females <- yellow_all %>%
  filter(sex == "female") 

#calculate the mean density of the nicos in the gills of yellow females
yellow_females_mean_density <- mean(yellow_females$total_nicos_gill)
yellow_females_mean_density

#calculate standard deviation of the mean density
yellow_females_mean_density_gills_sd <- sd(yellow_females$total_nicos_gill)
yellow_females_mean_density_gills_sd

```


#### ii) Red Females
```{r}
#subset for red females only

##sample size n = 1
red_females <- red_all %>%
  filter(sex == "female") 

#calculate the mean density of the nicos in the gills of red females
red_females_mean_density <- mean(red_females$total_nicos_gill)
red_females_mean_density

#calculate standard deviation of the mean density
red_females_mean_density_gills_sd <- sd(red_females$total_nicos_gill)
red_females_mean_density_gills_sd

```


#### iii) Brown Females
```{r}
#subset for brown females only

##sample size n = 1
brown_females <- brown_all %>%
  filter(sex == "female") 

#calculate the mean density of the nicos in the gills of red females
brown_females_mean_density <- mean(brown_females$total_nicos_gill)
brown_females_mean_density

#calculate standard deviation of the mean density
brown_females_mean_density_gills_sd <- sd(brown_females$total_nicos_gill)
brown_females_mean_density_gills_sd

```



### e) Mean Intensity (Yellow Males) (ignore)
```{r}
#calculate the mean intensity for the nicos in the gills 
male_mean_intensity_gills <- mean(males$intensity_nicos_gills)
male_mean_intensity_gills

```


### f) Mean Intensity (Yellow Females) (ignore)
```{r}
#calculate the mean intensity for the nicos in the gills 
female_mean_intensity_gills <- mean(females$intensity_nicos_gills)
female_mean_intensity_gills


```

# 10. Tables with Density

## a) Calculate Table Values
```{r}
#calculate sample size for each sex of each species 
yellow_male_n = length(yellow_males$crab_id)
yellow_male_n

yellow_female_n = length(yellow_females$crab_id)
yellow_female_n

red_male_n = length(red_males$crab_id)
red_male_n

red_female_n = length(red_females$crab_id)
red_female_n

brown_male_n = length(brown_males$crab_id)
brown_male_n

brown_female_n = length(brown_females$crab_id)
brown_female_n

#calculate sample size of all for a species 
total_yellow_n = (yellow_male_n + yellow_female_n)
total_yellow_n

total_red_n = (red_male_n + red_female_n)
total_red_n

total_brown_n = (brown_male_n + brown_female_n)
total_brown_n

#calculate the total sample size
total_n = (total_yellow_n + total_red_n + total_brown_n)
  
```



## b) Create a Table 
```{r}
#create a string with all the 
data_all <- c(yellow_male_n, yellow_female_n, red_male_n, red_female_n, brown_male_n, brown_female_n, yellow_males_mean_density, yellow_females_mean_density, red_males_mean_density, red_females_mean_density, brown_males_mean_density, brown_females_mean_density, yellow_males_mean_density_gills_sd, yellow_females_mean_density_gills_sd, red_males_mean_density_gills_sd, red_females_mean_density_gills_sd, brown_males_mean_density_gills_sd, brown_females_mean_density_gills_sd)

#turn the string into a matrix
matrix_all <- matrix(data_all, ncol = 3, byrow = FALSE)
colnames(matrix_all) <- c("Sample Size", "Mean Larval Nicothoids in Gills", "Standard Deviation")
rownames(matrix_all) <- c("Male C. anthonyi", "Female C. anthonyi", "Male C. productus", "Female C. productus", "Male C. antennarius", "Female C. antennarius")

#create the table
table_all <- matrix_all %>%
  kbl(caption = "<center>Density of Nicothoids</center>", html_font = "Times New Roman") %>%
  kable_classic(full_width = F, html_font = "Times New Roman") %>%
  row_spec(row = 1, italic = TRUE) %>%
  row_spec(row = 2, italic = TRUE) %>%
  row_spec(row = 3, italic = TRUE) %>%
  row_spec(row = 4, italic = TRUE) %>%
  row_spec(row = 5, italic = TRUE) %>%
  row_spec(row = 6, italic = TRUE) %>%
  kable_styling(font_size = 8) %>%
  footnote(symbol = "The density of the nicothoids in the gills is calculated to calculated the average count of total larval nicothoids present in all twelve gills.") %>%
  save_kable(file = "gill_density_all.png", 
             zoom = 3)

table_all


```


# 11. Timeseries continued

## a) Low Infestation

### i) Adults

#### -by day 
```{r}
#plot the number of adults over time per one million host eggs
low_timeseries_adults <- ggplot() +
  geom_line(data = low_timeseries_avg,
            aes(x = day, y = max_scaled_adults)) +
  geom_line(data = low_timeseries_avg,
            aes(x = day, y = min_scaled_adults)) +
  geom_ribbon(data = low_timeseries_avg,
              aes(x = day, 
                  ymin = min_scaled_adults,
                  ymax = max_scaled_adults),
              fill = "gray",
              alpha = 0.4) +
  geom_point(data = low_timeseries_avg,
            aes(x = day, y = scaled_adults), color = low) +
  theme_gray() +
  ylab("Adult Nicothoids per One Million Crab Eggs") +
  xlab("Development Day") + 
  #ggtitle(label = "Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

low_timeseries_adults

```


#### -by eds 
```{r}
#plot the number of adults over time per one million host eggs
low_timeseries_adults_eds <- ggplot() +
  geom_line(data = low_timeseries_avg_eds,
            aes(x = eds, y = max_scaled_adults)) +
  geom_line(data = low_timeseries_avg_eds,
            aes(x = eds, y = min_scaled_adults)) +
  geom_ribbon(data = low_timeseries_avg_eds,
              aes(x = eds, 
                  ymin = min_scaled_adults,
                  ymax = max_scaled_adults),
              fill = "gray",
              alpha = 0.4) +
  geom_point(data = low_timeseries_avg_eds,
            aes(x = eds, y = scaled_adults), color = low) +
  theme_gray() +
  ylab("Adult Nicothoids per One Million Crab Eggs") +
  xlab("Egg Development Stage") + 
  #ggtitle(label = "Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

low_timeseries_adults_eds

```


### ii) Juveniles

#### -by day 
```{r}
#plot the number of juveniles over time per one million host eggs
low_timeseries_juveniles <- ggplot() +
  geom_line(data = low_timeseries_avg,
            aes(x = day, y = max_scaled_juveniles)) +
  geom_line(data = low_timeseries_avg,
            aes(x = day, y = min_scaled_juveniles)) +
  geom_ribbon(data = low_timeseries_avg,
              aes(x = day, 
                  ymin = min_scaled_juveniles,
                  ymax = max_scaled_juveniles),
              fill = "gray",
              alpha = 0.4) +
  geom_point(data = low_timeseries_avg,
            aes(x = day, y = scaled_juveniles), color = low) +
  theme_gray() +
  ylab("Larval Nicothoids per One Million Crab Eggs") +
  xlab("Development Day") + 
  #ggtitle(label = "Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

low_timeseries_juveniles

```


#### -by eds 
```{r}
#plot the number of adults over time per one million host eggs
low_timeseries_juveniles_eds <- ggplot() +
  geom_line(data = low_timeseries_avg_eds,
            aes(x = eds, y = max_scaled_juveniles)) +
  geom_line(data = low_timeseries_avg_eds,
            aes(x = eds, y = min_scaled_juveniles)) +
  geom_ribbon(data = low_timeseries_avg_eds,
              aes(x = eds, 
                  ymin = min_scaled_juveniles,
                  ymax = max_scaled_juveniles),
              fill = "gray",
              alpha = 0.4) +
  geom_point(data = low_timeseries_avg_eds,
            aes(x = eds, y = scaled_juveniles), color = low) +
  theme_gray() +
  ylab("Larval Nicothoids per One Million Crab Eggs") +
  xlab("Egg Development Stage") + 
  #ggtitle(label = "Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

low_timeseries_juveniles_eds

```


### iii) Total Nicos

#### -by day 
```{r}
#plot the number of adults over time per one million host eggs
low_timeseries_total_nicos <- ggplot() +
  geom_line(data = low_timeseries_avg,
            aes(x = day, y = max_scaled_total_nicos )) +
  geom_line(data = low_timeseries_avg,
            aes(x = day, y = min_scaled_total_nicos )) +
  geom_ribbon(data = low_timeseries_avg,
              aes(x = day, 
                  ymin = min_scaled_total_nicos ,
                  ymax = max_scaled_total_nicos ),
              fill = "gray",
              alpha = 0.4) +
  geom_point(data = low_timeseries_avg,
            aes(x = day, y = scaled_total_nicos), color = low) +
  theme_gray() +
  ylab("Total Nicothoids per One Million Crab Eggs") +
  xlab("Development Day") + 
  #ggtitle(label = "Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

low_timeseries_total_nicos 

```


#### -by eds 
```{r}
#plot the number of adults over time per one million host eggs
low_timeseries_total_nicos_eds <- ggplot() +
  geom_line(data = low_timeseries_avg_eds,
            aes(x = eds, y = max_scaled_total_nicos)) +
  geom_line(data = low_timeseries_avg_eds,
            aes(x = eds, y = min_scaled_total_nicos)) +
  geom_ribbon(data = low_timeseries_avg_eds,
              aes(x = eds, 
                  ymin = min_scaled_total_nicos,
                  ymax = max_scaled_total_nicos),
              fill = "gray",
              alpha = 0.4) +
  geom_point(data = low_timeseries_avg_eds,
            aes(x = eds, y = scaled_total_nicos), color = low) +
  theme_gray() +
  ylab("Total Nicothoids per One Million Crab Eggs") +
  xlab("Egg Development Stage") + 
  #ggtitle(label = "Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

low_timeseries_total_nicos_eds

```



### iv) Nico Eggs

#### -by day 
```{r}
#plot the number of nico eggs over time per one million host eggs
low_timeseries_nico_eggs <- ggplot() +
  geom_line(data = low_timeseries_avg,
            aes(x = day, y = max_scaled_nico_eggs)) +
  geom_line(data = low_timeseries_avg,
            aes(x = day, y = min_scaled_nico_eggs)) +
  geom_ribbon(data = low_timeseries_avg,
              aes(x = day, 
                  ymin = min_scaled_nico_eggs,
                  ymax = max_scaled_nico_eggs),
              fill = "gray",
              alpha = 0.4) +
  geom_point(data = low_timeseries_avg,
            aes(x = day, y = scaled_nico_eggs), color = low) +
  theme_gray() +
  ylab("Nicothoids Eggs per One Million Crab Eggs") +
  xlab("Development Day") + 
  #ggtitle(label = "Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

low_timeseries_nico_eggs

```


#### -by eds 
```{r}
#plot the number of adults over time per one million host eggs
low_timeseries_nico_eggs_eds <- ggplot() +
  geom_line(data = low_timeseries_avg_eds,
            aes(x = eds, y = max_scaled_nico_eggs)) +
  geom_line(data = low_timeseries_avg_eds,
            aes(x = eds, y = min_scaled_nico_eggs)) +
  geom_ribbon(data = low_timeseries_avg_eds,
              aes(x = eds, 
                  ymin = min_scaled_nico_eggs,
                  ymax = max_scaled_nico_eggs),
              fill = "gray",
              alpha = 0.4) +
  geom_point(data = low_timeseries_avg_eds,
            aes(x = eds, y = scaled_nico_eggs), color = low) +
  theme_gray() +
  ylab("Nicothoids Eggs per One Million Crab Eggs") +
  xlab("Egg Development Stage") + 
  #ggtitle(label = "Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

low_timeseries_nico_eggs_eds

```



## b) High Infestation

### i) Adults

#### -by day 
```{r}
#plot the number of adults over time per one million host eggs
high_timeseries_adults <- ggplot() +
  geom_line(data = high_timeseries_avg,
            aes(x = day, y = max_scaled_adults)) +
  geom_line(data = high_timeseries_avg,
            aes(x = day, y = min_scaled_adults)) +
  geom_ribbon(data = high_timeseries_avg,
              aes(x = day, 
                  ymin = min_scaled_adults,
                  ymax = max_scaled_adults),
              fill = "gray",
              alpha = 0.4) +
  geom_point(data = high_timeseries_avg,
            aes(x = day, y = scaled_adults), color = high) +
  theme_gray() +
  ylab("Adult Nicothoids per One Million Crab Eggs") +
  xlab("Development Day") + 
  #ggtitle(label = "Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

high_timeseries_adults

```


#### -by eds
```{r}
#plot the number of adults over time per one million host eggs
high_timeseries_adults_eds <- ggplot() +
  geom_line(data = high_timeseries_avg_eds,
            aes(x = eds, y = max_scaled_adults)) +
  geom_line(data = high_timeseries_avg_eds,
            aes(x = eds, y = min_scaled_adults)) +
  geom_ribbon(data = high_timeseries_avg_eds,
              aes(x = eds, 
                  ymin = min_scaled_adults,
                  ymax = max_scaled_adults),
              fill = "gray",
              alpha = 0.4) +
  geom_point(data = high_timeseries_avg_eds,
            aes(x = eds, y = scaled_adults), color = high) +
  theme_gray() +
  ylab("Adult Nicothoids per One Million Crab Eggs") +
  xlab("Development Day") + 
  #ggtitle(label = "Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

high_timeseries_adults_eds

```




### ii) Juveniles

#### -by day 
```{r}
#plot the number of juveniles over time per one million host eggs
high_timeseries_juveniles <- ggplot() +
  geom_line(data = high_timeseries_avg,
            aes(x = day, y = max_scaled_juveniles)) +
  geom_line(data = high_timeseries_avg,
            aes(x = day, y = min_scaled_juveniles)) +
  geom_ribbon(data = high_timeseries_avg,
              aes(x = day, 
                  ymin = min_scaled_juveniles,
                  ymax = max_scaled_juveniles),
              fill = "gray",
              alpha = 0.4) +
  geom_point(data = high_timeseries_avg,
            aes(x = day, y = scaled_juveniles), color = high) +
  theme_gray() +
  ylab("Larval Nicothoids per One Million Crab Eggs") +
  xlab("Egg Development Stage") + 
  #ggtitle(label = "Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

high_timeseries_juveniles

```


#### -by eds
```{r}
#plot the number of adults over time per one million host eggs
high_timeseries_juveniles_eds <- ggplot() +
  geom_line(data = high_timeseries_avg_eds,
            aes(x = eds, y = max_scaled_juveniles)) +
  geom_line(data = high_timeseries_avg_eds,
            aes(x = eds, y = min_scaled_juveniles)) +
  geom_ribbon(data = high_timeseries_avg_eds,
              aes(x = eds, 
                  ymin = min_scaled_juveniles,
                  ymax = max_scaled_juveniles),
              fill = "gray",
              alpha = 0.4) +
  geom_point(data = high_timeseries_avg_eds,
            aes(x = eds, y = scaled_juveniles), color = high) +
  theme_gray() +
  ylab("Larval Nicothoids per One Million Crab Eggs") +
  xlab("Egg Development Stage") + 
  #ggtitle(label = "Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

high_timeseries_juveniles_eds

```



### iii) Total Nicos

#### -by day 
```{r}
#plot the number of adults over time per one million host eggs
high_timeseries_total_nicos <- ggplot() +
  geom_line(data = high_timeseries_avg,
            aes(x = day, y = max_scaled_total_nicos )) +
  geom_line(data = high_timeseries_avg,
            aes(x = day, y = min_scaled_total_nicos )) +
  geom_ribbon(data = high_timeseries_avg,
              aes(x = day, 
                  ymin = min_scaled_total_nicos ,
                  ymax = max_scaled_total_nicos ),
              fill = "gray",
              alpha = 0.4) +
  geom_point(data = high_timeseries_avg,
            aes(x = day, y = scaled_total_nicos), color = high) +
  theme_gray() +
  ylab("Total Nicothoids per One Million Crab Eggs") +
  xlab("Development Day") + 
  #ggtitle(label = "Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

high_timeseries_total_nicos 

```

#### -by eds
```{r}
#plot the number of adults over time per one million host eggs
high_timeseries_total_nicos_eds <- ggplot() +
  geom_line(data = high_timeseries_avg_eds,
            aes(x = eds, y = max_scaled_total_nicos)) +
  geom_line(data = high_timeseries_avg_eds,
            aes(x = eds, y = min_scaled_total_nicos)) +
  geom_ribbon(data = high_timeseries_avg_eds,
              aes(x = eds, 
                  ymin = min_scaled_total_nicos,
                  ymax = max_scaled_total_nicos),
              fill = "gray",
              alpha = 0.4) +
  geom_point(data = high_timeseries_avg_eds,
            aes(x = eds, y = scaled_total_nicos), color = high) +
  theme_gray() +
  ylab("Total Nicothoids per One Million Crab Eggs") +
  xlab("Egg Development Stage") + 
  #ggtitle(label = "Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

high_timeseries_total_nicos_eds

```



### iv) Nico Eggs

#### -by day 
```{r}
#plot the number of nico eggs over time per one million host eggs
high_timeseries_nico_eggs <- ggplot() +
  #geom_line(data = high_timeseries_avg,
            #aes(x = day, y = max_scaled_nico_eggs)) +
  #geom_line(data = high_timeseries_avg,
            #aes(x = day, y = min_scaled_nico_eggs)) +
  geom_ribbon(data = high_timeseries_avg,
              aes(x = day, 
                  ymin = min_scaled_nico_eggs,
                  ymax = max_scaled_nico_eggs),
              fill = "gray",
              alpha = 0.4) +
  geom_point(data = high_timeseries_avg,
            aes(x = day, y = scaled_nico_eggs), color = high) +
  theme_gray() +
  ylab("Nicothoids Eggs per One Million Crab Eggs") +
  xlab("Development Day") + 
  #ggtitle(label = "Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

high_timeseries_nico_eggs

```

#### -by eds
```{r}
#plot the number of adults over time per one million host eggs
high_timeseries_nico_eggs_eds <- ggplot() +
  geom_line(data = high_timeseries_avg_eds,
            aes(x = eds, y = max_scaled_nico_eggs)) +
  geom_line(data = high_timeseries_avg_eds,
            aes(x = eds, y = min_scaled_nico_eggs)) +
  geom_ribbon(data = high_timeseries_avg_eds,
              aes(x = eds, 
                  ymin = min_scaled_nico_eggs,
                  ymax = max_scaled_nico_eggs),
              fill = "gray",
              alpha = 0.4) +
  geom_point(data = high_timeseries_avg_eds,
            aes(x = eds, y = scaled_nico_eggs), color = high) +
  theme_gray() +
  ylab("Nicothoids Eggs per One Million Crab Eggs") +
  xlab("Egg Development Stage") + 
  #ggtitle(label = "Adult Nicos") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(size = 10),
        axis.title.x = element_text(size = 10))

high_timeseries_nico_eggs_eds

```



## c) Combined Plot

### i) Adults

#### -by day 
```{r}
#plot the data for the low and high infestations 
timeseries_vis_both_adults <- ggplot() +
  geom_point(data = low_timeseries_avg, 
       aes(x = day, y = scaled_adults), color = low) +
  geom_line(data = low_timeseries_avg, 
       aes(x = day, y = scaled_adults), color = low) +
  geom_point(data = high_timeseries_avg, 
       aes(x = day, y = scaled_adults), color = high) +
  geom_line(data = high_timeseries_avg, 
       aes(x = day, y = scaled_adults), color = high) +
  theme_gray() +
  ylab("Adult Nicothoids per One Million Crab Eggs") +
  xlab("Development Day") + 
  ggtitle(label = "Average Count Across Development Day",
          subtitle = "Low vs. High Infestation") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

timeseries_vis_both_adults

```


#### -by eds 
```{r}
#plot the data for the low and high infestations 
timeseries_vis_both_adults_eds <- ggplot() +
  geom_point(data = low_timeseries_avg_eds, 
       aes(x = eds, y = scaled_adults), color = low) +
  geom_line(data = low_timeseries_avg_eds, 
       aes(x = eds, y = scaled_adults), color = low) +
  geom_point(data = high_timeseries_avg_eds, 
       aes(x = eds, y = scaled_adults), color = high) +
  geom_line(data = high_timeseries_avg_eds, 
       aes(x = eds, y = scaled_adults), color = high) +
  theme_gray() +
  ylab("Adult Nicothoids per One Million Crab Eggs") +
  xlab("Egg Development Stage") + 
  ggtitle(label = "Average Count Across Egg Development Stage",
          subtitle = "Low vs. High Infestation") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

timeseries_vis_both_adults_eds

```


### ii) Juveniles

#### -by day 
```{r}
#plot the data for the low and high infestations 
timeseries_vis_both_juveniles <- ggplot() +
  geom_point(data = low_timeseries_avg, 
       aes(x = day, y = scaled_juveniles), color = low) +
  geom_line(data = low_timeseries_avg, 
       aes(x = day, y = scaled_juveniles), color = low) +
  geom_point(data = high_timeseries_avg, 
       aes(x = day, y = scaled_juveniles), color = high) +
  geom_line(data = high_timeseries_avg, 
       aes(x = day, y = scaled_juveniles), color = high) +
  theme_gray() +
  ylab("Larval Nicothoids per One Million Crab Eggs") +
  xlab("Development Day") + 
  ggtitle(label = "Average Count Across Development Day",
          subtitle = "Low vs. High Infestation") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

timeseries_vis_both_juveniles

```


#### -by eds 
```{r}
#plot the data for the low and high infestations 
timeseries_vis_both_juveniles_eds <- ggplot() +
  geom_point(data = low_timeseries_avg_eds, 
       aes(x = eds, y = scaled_juveniles), color = low) +
  geom_line(data = low_timeseries_avg_eds, 
       aes(x = eds, y = scaled_juveniles), color = low) +
  geom_point(data = high_timeseries_avg_eds, 
       aes(x = eds, y = scaled_juveniles), color = high) +
  geom_line(data = high_timeseries_avg_eds, 
       aes(x = eds, y = scaled_juveniles), color = high) +
  theme_gray() +
  ylab("Larval Nicothoids per One Million Crab Eggs") +
  xlab("Egg Development Stage") + 
  ggtitle(label = "Average Count Across Egg Development Stage",
          subtitle = "Low vs. High Infestation") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

timeseries_vis_both_juveniles_eds

```



### iii) Total Nicos

#### -by day 
```{r}
#plot the data for the low and high infestations 
timeseries_vis_both_total_nicos <- ggplot() +
  geom_point(data = low_timeseries_avg, 
       aes(x = day, y = scaled_total_nicos), color = low) +
  geom_line(data = low_timeseries_avg, 
       aes(x = day, y = scaled_total_nicos), color = low) +
  geom_point(data = high_timeseries_avg, 
       aes(x = day, y = scaled_total_nicos), color = high) +
  geom_line(data = high_timeseries_avg, 
       aes(x = day, y = scaled_total_nicos), color = high) +
  theme_gray() +
  ylab("Total Nicothoids per One Million Crab Eggs") +
  xlab("Development Day") + 
  ggtitle(label = "Average Count Across Development Day",
          subtitle = "Low vs. High Infestation") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

timeseries_vis_both_total_nicos

```


#### -by eds 
```{r}
#plot the data for the low and high infestations 
timeseries_vis_both_total_nicos_eds <- ggplot() +
  geom_point(data = low_timeseries_avg_eds, 
       aes(x = eds, y = scaled_total_nicos), color = low) +
  geom_line(data = low_timeseries_avg_eds, 
       aes(x = eds, y = scaled_total_nicos), color = low) +
  geom_point(data = high_timeseries_avg_eds, 
       aes(x = eds, y = scaled_total_nicos), color = high) +
  geom_line(data = high_timeseries_avg_eds, 
       aes(x = eds, y = scaled_total_nicos), color = high) +
  theme_gray() +
  ylab("Total Nicothoids per One Million Crab Eggs") +
  xlab("Egg Development Stage") + 
  ggtitle(label = "Average Count Across Egg Development Stage",
          subtitle = "Low vs. High Infestation") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

timeseries_vis_both_total_nicos_eds

```




### iv) Nico Eggs

#### -by day 
```{r}
#plot the data for the low and high infestations 
timeseries_vis_both_nico_eggs <- ggplot() +
  geom_point(data = low_timeseries_avg, 
       aes(x = day, y = scaled_nico_eggs), color = low) +
  geom_line(data = low_timeseries_avg, 
       aes(x = day, y = scaled_nico_eggs), color = low) +
  geom_point(data = high_timeseries_avg, 
       aes(x = day, y = scaled_nico_eggs), color = high) +
  geom_line(data = high_timeseries_avg, 
       aes(x = day, y = scaled_nico_eggs), color = high) +
  theme_gray() +
  ylab("Nicothoid Eggs per One Million Crab Eggs") +
  xlab("Development Day") + 
  ggtitle(label = "Average Count Across Development Day",
          subtitle = "Low vs. High Infestation") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

timeseries_vis_both_nico_eggs

```

#### -by eds 
```{r}
#plot the data for the low and high infestations 
timeseries_vis_both_nico_eggs_eds <- ggplot() +
  geom_point(data = low_timeseries_avg_eds, 
       aes(x = eds, y = scaled_nico_eggs), color = low) +
  geom_line(data = low_timeseries_avg_eds, 
       aes(x = eds, y = scaled_nico_eggs), color = low) +
  geom_point(data = high_timeseries_avg_eds, 
       aes(x = eds, y = scaled_nico_eggs), color = high) +
  geom_line(data = high_timeseries_avg_eds, 
       aes(x = eds, y = scaled_nico_eggs), color = high) +
  theme_gray() +
  ylab("Nicothoids Eggs per One Million Crab Eggs") +
  xlab("Egg Development Stage") + 
  ggtitle(label = "Average Count Across Egg Development Stage",
          subtitle = "Low vs. High Infestation") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

timeseries_vis_both_nico_eggs_eds

```



### v) All Together

#### -by day 
```{r}
#add the plots together
all_timeseries_low_high <- ggarrange(timeseries_vis_both_adults, timeseries_vis_both_juveniles, timeseries_vis_both_total_nicos, timeseries_vis_both_nico_eggs,
                           labels = c("a)", "b)", "c)", "d)"),
                           ncol = 2, nrow = 2)

#add a title for the figure 
annotate_figure(all_timeseries_low_high,
               top = text_grob("Timeseries by Development Day", color = "black", face = "bold", size = 14))

```


#### -by eds 
```{r}
#add the plots together
all_timeseries_low_high_eds <- ggarrange(timeseries_vis_both_adults_eds, timeseries_vis_both_juveniles_eds, timeseries_vis_both_total_nicos_eds, timeseries_vis_both_nico_eggs_eds,
                           labels = c("a)", "b)", "c)", "d)"),
                           ncol = 2, nrow = 2)

#add a title for the figure 
annotate_figure(all_timeseries_low_high_eds,
               top = text_grob("Timeseries by Egg Development Stage", color = "black", face = "bold", size = 14))

```


## d) Nicos per Nonviable Eggs 

```{r}
#plot the prop of nonviable eggs per total nicos
predation <- ggplot() +
  geom_point(data = low_timeseries_avg, 
       aes(x = day, y = (avg_prop_nonviable_eggs/avg_prop_total_nicos)), color = low) +
  geom_point(data = high_timeseries_avg, 
       aes(x = day, y = (avg_prop_nonviable_eggs/avg_prop_total_nicos)), color = high) +
  theme_gray() +
  ylab("Nonviable Crab Eggs per Total Nicothoids") +
  xlab("Development Day") + 
  theme()

predation

```



## e) Descriptive Stats
```{r}
#calculate the minimum and maximum counts from the egg mortality data alone
##calculate the minimum from samples proportions scaled to 1000 host eggs
min_total_nicos <- min(timeseries$prop_total_nicos)
min_total_nicos

##calculate the maximum from samples proportions scaled to 1000 host eggs
max_total_nicos <- max(timeseries$prop_total_nicos)
max_total_nicos

#calculate the mean number of adults from all the data 

```

